<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Linux,shell,文件操作,sed,">





  <link rel="alternate" href="/atom.xml" title="搬运工 + 践行者" type="application/atom+xml">






<meta name="description" content="介绍基础语法执行p命令行寻址使用数字模式的行寻址+操作符~操作符$用法使用文本模式的行寻址基础命令删除命令 d追加命令 a插入命令 i行替换命令 c替换命令 s转义引用排除命令 !&amp;amp;命令 存储匹配模式的内容=命令 打印行号输出隐藏字符命令 l正则表达式      介绍  1.用途  文本替换 选择性的输出文本文件 从文本文件的某处开始编辑 无交互式的对文本文件进行编辑  2.原理   读">
<meta name="keywords" content="Linux,shell,文件操作,sed">
<meta property="og:type" content="article">
<meta property="og:title" content="sed入门">
<meta property="og:url" content="http://blog.com/2019/03/16/sed入门/index.html">
<meta property="og:site_name" content="搬运工 + 践行者">
<meta property="og:description" content="介绍基础语法执行p命令行寻址使用数字模式的行寻址+操作符~操作符$用法使用文本模式的行寻址基础命令删除命令 d追加命令 a插入命令 i行替换命令 c替换命令 s转义引用排除命令 !&amp;amp;命令 存储匹配模式的内容=命令 打印行号输出隐藏字符命令 l正则表达式      介绍  1.用途  文本替换 选择性的输出文本文件 从文本文件的某处开始编辑 无交互式的对文本文件进行编辑  2.原理   读">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://blog.com/2019/03/16/sed入门/sed工作流.jpg">
<meta property="og:image" content="http://blog.com/2019/03/16/sed入门/p命令打印.png">
<meta property="og:updated_time" content="2019-03-16T10:26:40.260Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sed入门">
<meta name="twitter:description" content="介绍基础语法执行p命令行寻址使用数字模式的行寻址+操作符~操作符$用法使用文本模式的行寻址基础命令删除命令 d追加命令 a插入命令 i行替换命令 c替换命令 s转义引用排除命令 !&amp;amp;命令 存储匹配模式的内容=命令 打印行号输出隐藏字符命令 l正则表达式      介绍  1.用途  文本替换 选择性的输出文本文件 从文本文件的某处开始编辑 无交互式的对文本文件进行编辑  2.原理   读">
<meta name="twitter:image" content="http://blog.com/2019/03/16/sed入门/sed工作流.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.com/2019/03/16/sed入门/">





  <title>sed入门 | 搬运工 + 践行者</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">搬运工 + 践行者</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录学习的技能和遇到的问题</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.com/2019/03/16/sed入门/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘泽明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="搬运工 + 践行者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">sed入门</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-16T12:12:57+08:00">
                2019-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/shell/" itemprop="url" rel="index">
                    <span itemprop="name">shell</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/shell/sed/" itemprop="url" rel="index">
                    <span itemprop="name">sed</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/shell/sed/文件操作/" itemprop="url" rel="index">
                    <span itemprop="name">文件操作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <hr>
<ul><br><li><a href="#introduce">介绍</a></li><br><li><a href="#grammar">基础语法</a><br><ul><br><li><a href="#p">执行p命令</a></li><br><li><a href="#address">行寻址</a><br><ol><br><li><a href="#number_address">使用数字模式的行寻址</a><br><ol><br><li><a href="#+">+操作符</a></li><br><li><a href="#~">~操作符</a></li><br><li><a href="#$">$用法</a></li><br></ol><br></li><br><li><a href="#word_address">使用文本模式的行寻址</a></li><br></ol><br></li><br></ul><br></li><br><li><a href="#command">基础命令</a><br><ul><br><li><a href="#d">删除命令 d</a></li><br><li><a href="#a">追加命令 a</a></li><br><li><a href="#i">插入命令 i</a></li><br><li><a href="#c">行替换命令 c</a></li><br><li><a href="#s">替换命令 s</a></li><br><li><a href="#escaping">转义</a></li><br><li><a href="#reference">引用</a></li><br><li><a href="#!">排除命令 !</a></li><br><li><a href="#&">&amp;命令 存储匹配模式的内容</a></li><br><li><a href="#=">=命令 打印行号</a></li><br><li><a href="#l">输出隐藏字符命令 l</a></li><br></ul></li><br><li><a href="#expression">正则表达式</a></li><br></ul>





<h2 id="introduce">介绍</h2>

<p>1.用途</p>
<ul>
<li>文本替换</li>
<li>选择性的输出文本文件</li>
<li>从文本文件的某处开始编辑</li>
<li><em style="color:red;">无交互式的对文本文件进行编辑</em></li>
</ul>
<p>2.原理</p>
<p><img src="//blog.com/2019/03/16/sed入门/sed工作流.jpg" alt="sed工作流"></p>
<ul>
<li>读取： SED从输入流（文件，管道或者标准输入）中读取一行并且存储到它叫做 模式空间（pattern buffer） 的内部缓冲区</li>
<li>执行： 默认情况下，所有的SED命令都在模式空间中顺序的执行，除非指定了行的地址，否则SED命令将会在所有的行上依次执行</li>
<li>显示： 发送修改后的内容到输出流。在发送数据之后，模式空间将会被清空。<br>在文件所有的内容都被处理完成之前，上述过程将会重复执行</li>
</ul>
<p>需要注意的几点:</p>
<p>1.模式空间 （pattern buffer） 是一块活跃的缓冲区，在sed编辑器执行命令时它会保存待检查的文本<br>默认情况下，所有的SED命令都是在模式空间中执行，因此输入文件并不会发生改变</p>
<p>2.如果没有提供输入文件的话，SED将会从标准输入接收请求</p>
<p>3.如果没有提供地址范围的话，默认情况下SED将会对所有的行进行操作</p>
<h2 id="grammar">基础语法</h2>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed [-n] [-e] &apos;command(s)&apos; files </span><br><span class="line">sed [-n] -f scriptfile files</span><br></pre></td></tr></table></figure>
<p>标准选项<br>SED支持下列标准选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-n 默认情况下，模式空间中的内容在处理完成后将会打印到标准输出，该选项用于阻止该行为(仅显示script处理后的结果)</span><br><span class="line">    </span><br><span class="line">-e 指定要执行的命令，使用该参数，我们可以指定多个命令，让我们打印每一行两次：</span><br><span class="line">    </span><br><span class="line">-f 指定包含要执行的命令的脚本文件</span><br></pre></td></tr></table></figure>
<p>GNU选项<br>这些选项是GNU规范定义的，可能对于某些版本的SED并不支持。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-n， --quiet, --slient：与标准的-n选项相同</span><br><span class="line"></span><br><span class="line">-e script，--expression=script：与标准的-e选项相同</span><br><span class="line"></span><br><span class="line">-f script-file， --file=script-file：与标准的-f选项相同</span><br><span class="line"></span><br><span class="line">--follow-symlinks：如果提供该选项的话，在编辑的文件是符号链接时，SED将会跟随链接</span><br><span class="line"></span><br><span class="line">-i[SUFFIX]，--in-place[=SUFFIX]：该选项用于对当前文件进行编辑，如果提供了SUFFIX的话，将会备份原始文件，否则将会覆盖原始文件</span><br><span class="line"></span><br><span class="line">-l N， --line-lenght=N：该选项用于设置行的长度为N个字符</span><br><span class="line"></span><br><span class="line">--posix：该选项禁用所有的GNU扩展</span><br><span class="line"></span><br><span class="line">-r，--regexp-extended：该选项将启用扩展的正则表达式</span><br><span class="line"></span><br><span class="line">-u， --unbuffered：指定该选项的时候，SED将会从输入文件中加载最少的数据，并且更加频繁的刷出到输出缓冲区。在编辑tail</span><br><span class="line"></span><br><span class="line">-f命令的输出，你不希望等待输出的时候该选项是非常有用的。</span><br><span class="line"></span><br><span class="line">-z，--null-data：默认情况下，SED对每一行使用换行符分割，如果提供了该选项的话，它将使用NULL字符分割行</span><br><span class="line"></span><br><span class="line">cat books.txt</span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p><span id="p">(1)执行p命令</span></p>
<p>sed ‘p’ books.txt<br><img src="//blog.com/2019/03/16/sed入门/p命令打印.png" alt="p命令打印"></p>
<p>你可能会疑惑，为什么每一行被显示了两次？</p>
<p>你还记得SED的工作流吗？默认情况下，SED将会输出模式空间中的内容，另外，我们的命令中包含了输出命令p，因此每一行被打印两次。但是不要担心，SED提供了<strong>-n</strong>参数用于禁止自动输出模式空间的每一行的行为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n &apos;p&apos; books.txt </span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<h2 id="address">行寻址</h2>

<p>&nbsp;&nbsp;&nbsp;&nbsp;默认情况下，在SED中使用的命令会作用于文本数据的所有行。如果只想将命令作用于特定的行或者某些行，则需要使用行寻址功能。</p>
<p><em style="color:red;"><br>在SED中包含两种形式的行寻址：</em></p>
<p>以数字形式表示的行区间<br>以文本模式来过滤行</p>
<p>[address]command<br></p>
<h2 id="number_address">数字方式的行寻址</h2>

<p>1.打印第3行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;3p&apos; books.txt </span><br><span class="line"></span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197</span><br></pre></td></tr></table></figure>
<p>2.逗号<strong>,</strong>分隔输出行号的范围(打印2-5行)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;2,5 p&apos; books.txt </span><br><span class="line"></span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288</span><br></pre></td></tr></table></figure>
<p><span id="$">3.特殊字符 $ 代表了文件的最后一行，输出文件的最后一行</span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;$ p&apos; books.txt </span><br><span class="line">    </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>  &nbsp;&nbsp;&nbsp;打印第3行到最后一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;3,$ p&apos; books.txt</span><br><span class="line"></span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197</span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432</span><br><span class="line">    5) The Pilgrimage, Paulo Coelho,288</span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>​<br><span id="+">4.加号（+）操作符，它可以与逗号（,）操作符一起使用，例如 M, +n 将会打印出M行以及后面的n行(输出第2行及其后面的4行)</span></p>
<p><em style="color:red;">同时支持两种寻址方式</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;2,+4 p&apos; books.txt </span><br><span class="line">    </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br><span class="line">  </span><br><span class="line">sed -n &apos;/Alchemist/,+2 p&apos; books.txt </span><br><span class="line"></span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    </span><br><span class="line">sed -n &apos;/Alchemist/,+3 p&apos; books.txt </span><br><span class="line"></span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br><span class="line">    </span><br><span class="line"> sed &apos;1,+4 d&apos; books.txt </span><br><span class="line"></span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br><span class="line">    </span><br><span class="line">sed &apos;1,+4 a liuzeming&apos; books.txt </span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    liuzeming</span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    liuzeming</span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    liuzeming</span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    liuzeming</span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    liuzeming</span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p> <span id="~">5.波浪线操作符（~）指定地址范围，它使用M~N的形式，它告诉SED应该处理从M行开始，每隔N行才输出</span>           </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;50~5匹配行号50，55，60，65</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;只输出文件中的奇数行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;1~2 p&apos; books.txt </span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;只输出文件中的偶数行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;2~2 p&apos; books.txt </span><br><span class="line"></span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864 </span><br><span class="line">    </span><br><span class="line">sed &apos;2~2 d&apos; books.txt </span><br><span class="line"> </span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288</span><br><span class="line">    </span><br><span class="line">sed &apos;2~2 a liuzeming&apos; books.txt </span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    liuzeming</span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    liuzeming</span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br><span class="line">    liuzeming</span><br></pre></td></tr></table></figure>
<h2 id="word_address">使用文本模式的行寻址</h2>

<p>SED编辑器允许指定文本模式来过滤出命令要作用的行。格式如下：</p>
<p>/pattern/ command<br>必须用正斜线将要指定的pattern封起来。sed编辑器会将该命令作用到包含指定文本模式的行上</p>
<p>1.打印所有作者为Paulo Coelho的书籍。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/Paulo/ p&apos; books.txt</span><br><span class="line"></span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288</span><br></pre></td></tr></table></figure>
<p>2.模式匹配也可以与数字形式的寻址同时使用(从第一次匹配到Alchemist开始输出，直到第5行为止)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/Alchemist/, 5 p&apos; books.txt</span><br><span class="line"></span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288</span><br></pre></td></tr></table></figure>
<p>3.使用逗号（,）操作符指定匹配多个匹配的模式(输出Two和Pilgrimage之间的所有行)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/Two/, /Pilgrimage/ p&apos; books.txt</span><br><span class="line"></span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288</span><br></pre></td></tr></table></figure>
<p>4.在使用文本模式过滤器的时候，与数字方式的行寻址类似，可以使用加号操作符 +，它会输出从第一次匹配的行以及后面的n行(输出第一次Two出现的位置开始接下来的4行)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/Two/, +4 p&apos; books.txt</span><br><span class="line"></span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<h2 id="command">基本命令</h2>

<p><span id="d">1.删除命令 d</span></p>
<p>删除命令格式如下:</p>
<p>[address1[,address2]]d</p>
<p>address1和address2是开始和截止地址，它们可以是行号或者字符串匹配模式，这两种地址都是可选的。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;由命令的名称可以知道，delete命令是用来执行删除操作的，并且因为SED是基于行的编辑器，因此我们说该命令是用来删除行的。<em style="color:red;">注意的是，该命令只会移除模式空间中的行，这样该行就不会被发送到输出流，但原始内容不会改变。</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;d&apos; books.txt</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;为什么没有输出任何内容？默认情况下，SED将会对每一行执行删除操作，这就是该命令为什么没有在标准输出中输出任何内容的原因。</p>
<p>&nbsp;&nbsp;&nbsp;只移除第四行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;4 d&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;删除2-4行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;2, 4 d&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;移除所有作者为Paulo Coelho的书籍</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/Paulo Coelho/d&apos; books.txt </span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;移除第一次匹配Storm，第一次匹配Fellowship之间的所有行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/Storm/,/Fellowship/d&apos; books.txt  </span><br><span class="line"></span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p><span id="a">2.追加命令 a</span></p>
<p>文本追加命令语法：</p>
<p>[address] a Append text </p>
<p>&nbsp;&nbsp;&nbsp;在第四行之后追加一本新书：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;4 a 7) Adultry, Paulo Coelho, 234&apos; books.txt </span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    7) Adultry, Paulo Coelho, 234 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br><span class="line">    </span><br><span class="line">在命令部分，4指的是行号，a 是append命令，剩余部分为要追加的文本。</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;在文件的结尾插入一行文本，使用 $ 作为地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;$ a 7) Adultry, Paulo Coelho, 234&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864 </span><br><span class="line">    7) Adultry, Paulo Coelho, 234</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;在匹配 The Alchemist 的行之后追加文本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/The Alchemist/ a 7) Adultry, Paulo Coelho, 234&apos; books.txt </span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    7) Adultry, Paulo Coelho, 234 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p><span id="c">3.行替换命令 c</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;SED通过 c 提供了 change 和 replace 命令，该命令帮助我们使用新文本替换已经存在的行，当提供行的地址范围时，所有的行都被作为一组被替换为单行文本<em style="color:red;">如果选中的行连续,将作为一个整体被新的文本替换</em>，下面是该命令的语法:</p>
<p>[address1[,address2]] c Replace text</p>
<p>&nbsp;&nbsp;&nbsp;替换文本中的第三行为新的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;3 c 3) Adultry, Paulo Coelho, 324&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) Adultry, Paulo Coelho, 324 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;第4-6行内容替换为单行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;4, 6 c 4) Adultry, Paulo Coelho, 324&apos; books.txt  </span><br><span class="line">    </span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) Adultry, Paulo Coelho, 324</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;SED也接受模式作为地址(替换所有含The Alchemist的行)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/The Alchemist/ c 3) Adultry, Paulo Coelho, 324&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) Adultry, Paulo Coelho, 324 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;替换所有含The的行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/The/ c 3) Adultry, Paulo Coelho, 324&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    3) Adultry, Paulo Coelho, 324</span><br><span class="line">    3) Adultry, Paulo Coelho, 324</span><br><span class="line">    3) Adultry, Paulo Coelho, 324</span><br><span class="line">    3) Adultry, Paulo Coelho, 324</span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p><span id="i">4.插入命令 i</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;插入命令与追加命令类似，唯一的区别是插入命令是在匹配的位置前插入新的一行。</p>
<p>[address] i Insert text </p>
<p>&nbsp;&nbsp;&nbsp;在第4行前插入新的一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;4 i 7) Adultry, Paulo Coelho, 324&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    7) Adultry, Paulo Coelho, 324 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;在第4-5行前插入新的一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;4,5 i 7) Adultry, Paulo Coelho, 324&apos; books.txt</span><br><span class="line">   </span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    7) Adultry, Paulo Coelho, 324</span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    7) Adultry, Paulo Coelho, 324</span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p><span id="s">5.替换命令 s</span></p>
<p>文本替换命令非常常见，其格式如下</p>
<p>[address1[,address2]] s/pattern/replacement/[flags]</p>
<p>&nbsp;&nbsp;&nbsp;使用替换命令将其替换为管道符“|”：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;s/,/ |/&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) Storm of Swords | George R. R. Martin, 1216</span><br><span class="line">    2) The Two Towers | J. R. R. Tolkien, 352</span><br><span class="line">    3) The Alchemist | Paulo Coelho, 197</span><br><span class="line">    4) The Fellowship of the Ring | J. R. R. Tolkien, 432</span><br><span class="line">    5) The Pilgrimage | Paulo Coelho, 288</span><br><span class="line">    6) A Game of Thrones | George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;是不是觉得哪里不对？相信你已经发现，每一行的第二个逗号都没有被替换，只有第一个被替换了，确实如此，在SED中，使用替换命令的时候默认只会对第一个匹配的位置进行替换。使用g选项告诉SED对所有内容进行替换：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;s/,/ | /g&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) Storm of Swords |  George R. R. Martin |  1216</span><br><span class="line">    2) The Two Towers |  J. R. R. Tolkien |  352</span><br><span class="line">    3) The Alchemist |  Paulo Coelho |  197</span><br><span class="line">    4) The Fellowship of the Ring |  J. R. R. Tolkien |  432</span><br><span class="line">    5) The Pilgrimage |  Paulo Coelho |  288</span><br><span class="line">    6) A Game of Thrones |  George R. R. Martin |  864</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;如果对匹配模式（或地址范围）的行进行替换，则只需要在s命令前添加地址即可。</p>
<p>&nbsp;&nbsp;&nbsp;只替换匹配The Pilgrimage的行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/The Pilgrimage/ s/,/ | /g&apos; books.txt</span><br><span class="line">    </span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) The Pilgrimage |  Paulo Coelho |  288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p>还有一些其它的选项，这里就简单的描述一下，不在展开讲解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数字n: 只替换第n次匹配，比如sed &apos;s/,/ | /2&apos; books.txt 只替换每行中第二个逗号</span><br><span class="line">p：只输出改变的行，比如sed -n &apos;s/Paulo Coelho/PAULO COELHO/p&apos; books.txt</span><br><span class="line">w：存储改变的行到文件，比如sed -n &apos;s/Paulo Coelho/PAULO COELHO/w junk.txt&apos; books.txt</span><br><span class="line">i：匹配时忽略大小写，比如sed &apos;s/pAuLo CoElHo/PAULO COELHO/pi&apos; books.txt</span><br></pre></td></tr></table></figure>
<p><span id="escaping">转义</span></p>
<p>在执行替换操作的时候，如果要替换的内容中包含/，这个时候怎么办？很简单，添加转义操作符。</p>
<p>$ echo “/bin/sed” | sed ‘s/\/bin\/sed/\/home\/mylxsw\/src\/sed\/sed-4.2.2\/sed/‘<br>/home/mylxsw/src/sed/sed-4.2.2/sed</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;上面的命令中，我们使用\对/进行了转义，不过表达式已经看起来非常难看了，在SED中还可以使用|，@，^，!作为命令的分隔符，所以，下面的几个命令和上面的是等价的</p>
<p>echo “/bin/sed” | sed ‘s|/bin/sed|/mylxsw/mylxsw/src/sed/sed-4.2.2/sed|’<br>echo “/bin/sed” | sed ‘s@/bin/sed@/home/mylxsw/src/sed/sed-4.2.2/sed@’<br>echo “/bin/sed” | sed ‘s^/bin/sed^/home/mylxsw/src/sed/sed-4.2.2/sed^’<br>echo “/bin/sed” | sed ‘s!/bin/sed!/home/mylxsw/src/sed/sed-4.2.2/sed!’</p>
<p><span id="reference">引用</span></p>
<p>在SED中，使用(和)对匹配的内容进行分组，使用\N的方式进行引用。请看下面示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Three One Two&quot; | sed &apos;s|\(\w\+\) \(\w\+\) \(\w\+\)|\2 \3 \1|&apos;</span><br><span class="line">    </span><br><span class="line">    One Two Three</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;我们输出了Three，One，Two三个单词，在SED的替换规则中，使用空格分隔了三小段正则表达式(\w+)来匹配每一个单词，后面使用\1，，\2，\3分别引用它们的值。</p>
<p><span id="!">6.排除命令 !</span></p>
<p>感叹号命令（!）用来排除命令，也就是让原本会起作用的命令不起作用。</p>
<p>&nbsp;&nbsp;&nbsp;只输出匹配Paulo的行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/Paulo/p&apos; books.txt</span><br><span class="line"></span><br><span class="line">    3) The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    5) The Pilgrimage, Paulo Coelho, 288</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;只输出不匹配Paulo的行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/Paulo/!p&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    4) The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br></pre></td></tr></table></figure>
<p><span id="=">7. =命令 打印行号</span></p>
<p>=命令用于输出行号，语法格式为</p>
<p>[/pattern/]=<br>[address1[,address2]]=</p>
<p>&nbsp;&nbsp;&nbsp;为每一行输出行号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;=&apos; books2.txt</span><br><span class="line">    1</span><br><span class="line">    A Storm of Swords</span><br><span class="line">    2</span><br><span class="line">    George R. R. Martin</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;只为1-4行输出行号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;1, 4=&apos; books2.txt</span><br><span class="line">    1</span><br><span class="line">    A Storm of Swords</span><br><span class="line">    2</span><br><span class="line">    George R. R. Martin</span><br><span class="line">    3</span><br><span class="line">    The Two Towers</span><br><span class="line">    4</span><br><span class="line">    J. R. R. Tolkien</span><br><span class="line">    The Alchemist</span><br><span class="line">    Paulo Coelho</span><br><span class="line">    The Fellowship of the Ring</span><br><span class="line">    J. R. R. Tolkien</span><br><span class="line">    The Pilgrimage</span><br><span class="line">    Paulo Coelho</span><br><span class="line">    A Game of Thrones</span><br><span class="line">    George R. R. Martin</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;匹配Paulo的行输出行号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/Paulo/ =&apos; books2.txt</span><br><span class="line">    A Storm of Swords</span><br><span class="line">    George R. R. Martin</span><br><span class="line">    The Two Towers</span><br><span class="line">    J. R. R. Tolkien</span><br><span class="line">    The Alchemist</span><br><span class="line">    6</span><br><span class="line">    Paulo Coelho</span><br><span class="line">    The Fellowship of the Ring</span><br><span class="line">    J. R. R. Tolkien</span><br><span class="line">    The Pilgrimage</span><br><span class="line">    10</span><br><span class="line">    Paulo Coelho</span><br><span class="line">    A Game of Thrones</span><br><span class="line">    George R. R. Martin</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;输出文件总共有多少行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;$ =&apos; books.txt</span><br><span class="line">    6</span><br></pre></td></tr></table></figure>
<p><span id="&">8. &amp;命令 存储匹配模式的内容</span></p>
<p>特殊字符&amp;用于存储匹配模式的内容，通常与替换命令s一起使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;s/The/Book number &amp;/&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) A Storm of Swords, George R. R. Martin, 1216 </span><br><span class="line">    2) Book number The Two Towers, J. R. R. Tolkien, 352 </span><br><span class="line">    3) Book number The Alchemist, Paulo Coelho, 197 </span><br><span class="line">    4) Book number The Fellowship of the Ring, J. R. R. Tolkien, 432 </span><br><span class="line">    5) Book number The Pilgrimage, Paulo Coelho, 288 </span><br><span class="line">    6) A Game of Thrones, George R. R. Martin, 864</span><br><span class="line">这里的&amp;包含的内容就是The</span><br></pre></td></tr></table></figure>
<p><span id="l">9. 输出隐藏字符命令 l</span></p>
<p>你能通过直接观察区分出单词是通过空格还是tab进行分隔的吗？显然是不能的，但是SED可以为你做到这点。使用l命令（英文字母L的小写）可以显示文本中的隐藏字符（例如\t或者$字符）。</p>
<p>[address1[,address2]]l<br>[address1[,address2]]l [len] </p>
<p>为了测试该命令，我们首先将books.txt中的空格替换为tab。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;s/ /\t/g&apos; books.txt &gt; junk.txt</span><br></pre></td></tr></table></figure>
<p>接下来执行l命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;l&apos; junk.txt</span><br><span class="line"></span><br><span class="line">    1)\tStorm\tof\tSwords,\tGeorge\tR.\tR.\tMartin,\t1216\t$</span><br><span class="line">    2)\tThe\tTwo\tTowers,\tJ.\tR.\tR.\tTolkien,\t352\t$</span><br><span class="line">    3)\tThe\tAlchemist,\tPaulo\tCoelho,\t197\t$</span><br><span class="line">    4)\tThe\tFellowship\tof\tthe\tRing,\tJ.\tR.\tR.\tTolkien,\t432\t$</span><br><span class="line">    5)\tThe\tPilgrimage,\tPaulo\tCoelho,\t288\t$</span><br><span class="line">    6)\tA\tGame\tof\tThrones,\tGeorge\tR.\tR.\tMartin,\t864$</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;使用l命令的时候，一个很有趣的特性是我们可以使用它来实现文本按照指定的宽度换行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;l 25&apos; books.txt</span><br><span class="line"></span><br><span class="line">    1) Storm of Swords, Geor\</span><br><span class="line">    ge R. R. Martin, 1216 $</span><br><span class="line">    2) The Two Towers, J. R.\</span><br><span class="line">     R. Tolkien, 352 $</span><br><span class="line">    3) The Alchemist, Paulo \</span><br><span class="line">    Coelho, 197 $</span><br><span class="line">    4) The Fellowship of the\</span><br><span class="line">     Ring, J. R. R. Tolkien,\</span><br><span class="line">     432 $</span><br><span class="line">    5) The Pilgrimage, Paulo\</span><br><span class="line">     Coelho, 288 $</span><br><span class="line">    6) A Game of Thrones, Ge\</span><br><span class="line">    orge R. R. Martin, 864$</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;上面的示例中在l命令后跟了一个数字25，它告诉SED按照每行25个字符进行换行，如果指定这个数字为0的话，则只有在存在换行符的情况下才进行换行。   </p>
<h2 id="sed在指定字符前后添加内容"><a href="#sed在指定字符前后添加内容" class="headerlink" title="sed在指定字符前后添加内容"></a>sed在指定字符前后添加内容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat /tmp/input.txt</span><br><span class="line"></span><br><span class="line">    null</span><br><span class="line">    000011112222</span><br><span class="line"></span><br><span class="line">    test</span><br><span class="line">    </span><br><span class="line"> (1) 在1111之前添加AAA,方法如下:</span><br><span class="line"> </span><br><span class="line"> sed -i &apos;s/指定的字符/要插入的字符&amp;/&apos;  文件</span><br><span class="line"> </span><br><span class="line"> sed -i  &apos;s/1111/AAA&amp;/&apos; /tmp/input.txt </span><br><span class="line"> </span><br><span class="line"> (2)  在1111之后添加BBB，方法如下:</span><br><span class="line"> </span><br><span class="line"> sed -i &apos;s/指定的字符/&amp;要插入的字符/&apos;  文件</span><br><span class="line"> </span><br><span class="line"> sed -i  &apos;s/1111/&amp;BBB/&apos; /tmp/input.txt</span><br><span class="line">  </span><br><span class="line"> (3)  (1) 删除所有空行；(2) 一行中，如果包含&quot;1111&quot;，则在&quot;1111&quot;前面插入&quot;AAA&quot;，在&quot;11111&quot;后面插入&quot;BBB&quot;</span><br><span class="line"> </span><br><span class="line"> sed &apos;/^$/d;s/1111/AAA&amp;/;s/1111/&amp;BBB/&apos; /tmp/input.txt</span><br><span class="line"></span><br><span class="line"> (4)  在每行的头添加字符，比如&quot;HEAD&quot;，命令如下:</span><br><span class="line"> </span><br><span class="line"> sed -i &apos;s/^/HEAD&amp;/&apos; /tmp/input.txt</span><br><span class="line"> </span><br><span class="line"> (5)  在每行的尾部添加字符，比如&quot;tail&quot;，命令如下:</span><br><span class="line"> </span><br><span class="line"> sed -i &apos;s/$/&amp;tail/&apos; /tmp/input.txt</span><br></pre></td></tr></table></figure>
<p><strong>1. &amp;作反向引用，代替前面的匹配项(这个正则表达式匹配的这一行的部分内容)</strong></p>
<p><strong>2. “^”代表行首，”$”代表行尾</strong></p>
<p><strong>3. ‘s/$/&amp;tail/g’中的字符g代表每行出现的字符全部替换，如果想在特定字符处添加，g就有用了，否则只会替换每行第一个，而不继续往后找。</strong></p>
<h2 id="删除文件每一行的前k个字符、在文本的行尾或行首添加字符"><a href="#删除文件每一行的前k个字符、在文本的行尾或行首添加字符" class="headerlink" title="删除文件每一行的前k个字符、在文本的行尾或行首添加字符"></a>删除文件每一行的前k个字符、在文本的行尾或行首添加字符</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cat tmp.txt </span><br><span class="line">123456789</span><br><span class="line"></span><br><span class="line"># 删除每行第一个字符</span><br><span class="line">sed &apos;s/.//&apos; tmp.txt </span><br><span class="line"></span><br><span class="line">23456789</span><br><span class="line"></span><br><span class="line"># 删除每行前两个字符</span><br><span class="line">sed &apos;s/..//&apos; tmp.txt </span><br><span class="line"></span><br><span class="line">3456789</span><br><span class="line"></span><br><span class="line"># 删除每行前k个字符，例如k=5</span><br><span class="line">sed &apos;s/.\&#123;5\&#125;//&apos; tmp.txt </span><br><span class="line"></span><br><span class="line">6789</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat tmp.txt </span><br><span class="line">23456789</span><br><span class="line"></span><br><span class="line"># 在行首添加双引号(&quot;)</span><br><span class="line">cat tmp.txt | sed &apos;s/^/&quot;&amp;/g&apos;</span><br><span class="line">&quot;23456789</span><br><span class="line">&quot;23456789</span><br><span class="line">&quot;23456789</span><br><span class="line"></span><br><span class="line"># 在行尾添加双引号和逗号(&quot;,)</span><br><span class="line">cat tmp.txt | sed &apos;s/^/&quot;&amp;/g&apos; | sed &apos;s/$/&quot;,&amp;/g&apos;</span><br><span class="line">&quot;23456789&quot;,</span><br><span class="line">&quot;23456789&quot;,</span><br><span class="line">&quot;23456789&quot;,</span><br></pre></td></tr></table></figure>
<h2 id="删除行首空格"><a href="#删除行首空格" class="headerlink" title="删除行首空格"></a>删除行首空格</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;s/^[ ]*//g&apos; filename</span><br><span class="line"></span><br><span class="line">sed &apos;s/^ *//g&apos; filename</span><br><span class="line"></span><br><span class="line">sed &apos;s/^[[:space:]]*//g&apos; filename</span><br></pre></td></tr></table></figure>
<h2 id="行后和行前添加新行"><a href="#行后和行前添加新行" class="headerlink" title="行后和行前添加新行"></a>行后和行前添加新行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;s/pattern/&amp;\n/g&apos; filename</span><br><span class="line"></span><br><span class="line">sed &apos;s/pattern/\n&amp;/g&apos; filename</span><br></pre></td></tr></table></figure>
<h2 id="使用变量替换-使用双引号"><a href="#使用变量替换-使用双引号" class="headerlink" title="使用变量替换(使用双引号)"></a>使用变量替换(使用双引号)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e “s/$var1/$var2/g” filename</span><br></pre></td></tr></table></figure>
<h2 id="同时执行多个动作"><a href="#同时执行多个动作" class="headerlink" title="同时执行多个动作"></a>同时执行多个动作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. 用;好分割</span><br><span class="line"></span><br><span class="line">sed -i &apos;/^$/d;s/111/AAA/;s/1111/BBB/&apos; input.txt</span><br><span class="line"></span><br><span class="line">2. -e </span><br><span class="line"></span><br><span class="line">sed -e &quot;s/0000/kkk/&quot; -e &quot;s/AAA/aaa/g&quot;  -i -e  &quot;/test/d&quot; input.txt</span><br><span class="line"></span><br><span class="line">有一个使用了-i则所有的修改都会影响原文件</span><br></pre></td></tr></table></figure>
<h2 id="字符替换-y替换"><a href="#字符替换-y替换" class="headerlink" title="字符替换(y替换)"></a>字符替换(y替换)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;sorry&quot;|sed &apos;y/ory/ABC/&apos;       #一一对应替换（sABBC）</span><br></pre></td></tr></table></figure>
<h2 id="指定开始替换位置"><a href="#指定开始替换位置" class="headerlink" title="指定开始替换位置"></a>指定开始替换位置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo sksksksksksk | sed &apos;s/sk/SK/2g&apos;   //skSKSKSKSKSK</span><br><span class="line"></span><br><span class="line">echo sksksksksksk | sed &apos;s/sk/SK/3g&apos;   //skskSKSKSKSK</span><br><span class="line"></span><br><span class="line">echo sksksksksksk | sed &apos;s/sk/SK/4g&apos;   //skskskSKSKSK</span><br></pre></td></tr></table></figure>
<h2 id="指定定界符"><a href="#指定定界符" class="headerlink" title="指定定界符"></a>指定定界符</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;testliuzemingtest&quot;|sed &apos;s:test:TEXT:g&apos;   //TEXTliuzemingTEXT</span><br><span class="line"></span><br><span class="line">echo &quot;testliuzemingtest&quot;|sed &apos;s%test%TEXT%g&apos;</span><br><span class="line"></span><br><span class="line">cat /etc/passwd|sed &apos;s/\/bin/\/usr\/local\/bin/g&apos;</span><br><span class="line"></span><br><span class="line">echo &quot;app\Http\Controllers\ProfileController.php&quot;|sed &apos;s%\\%/%g&apos;     //app/Http/Controllers/ProfileController.php</span><br><span class="line"></span><br><span class="line">/ 在sed中作为定界符使用，也可以使用任意的定界符</span><br><span class="line">定界符出现在样式内部时，需要进行转义</span><br></pre></td></tr></table></figure>
<p>##已匹配字符串标记&amp;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则表达式 \w\+ 匹配每一个单词，使用 [&amp;] 替换它，&amp; 对应于之前所匹配到的单词</span><br><span class="line"></span><br><span class="line">echo this is a test line | sed &apos;s/\w\+/[&amp;]/g&apos; //[this] [is] [a] [test] [line]</span><br></pre></td></tr></table></figure>
<h2 id="子串匹配标记-1"><a href="#子串匹配标记-1" class="headerlink" title="子串匹配标记\1"></a>子串匹配标记\1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo this is digit 7 in a number | sed &apos;s/digit \([0-9]\)/\1/&apos;   //this is 7 in a number</span><br><span class="line"></span><br><span class="line">echo aaa BBB | sed &apos;s/\([a-z]\+\) \([A-Z]\+\)/\2 \1/&apos;            //BBB aaa</span><br><span class="line"></span><br><span class="line">echo &quot;loveable&quot;|sed -n &apos;s/\(love\)able/\1rs/p&apos;                   //lovers</span><br></pre></td></tr></table></figure>
<h2 id="下一个：n命令"><a href="#下一个：n命令" class="headerlink" title="下一个：n命令"></a>下一个：n命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat test.txt |sed -n &apos;/t/&#123; n; p;&#125;&apos;        //打印包含字母t的下一行</span><br><span class="line"></span><br><span class="line">如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续：</span><br><span class="line"></span><br><span class="line">sed &apos;/test/&#123; n; s/aa/bb/; &#125;&apos; file</span><br></pre></td></tr></table></figure>
<h2 id="从文件读入：r命令"><a href="#从文件读入：r命令" class="headerlink" title="从文件读入：r命令"></a>从文件读入：r命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/t/r /etc/passwd&apos; test.txt</span><br><span class="line"></span><br><span class="line">file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面</span><br></pre></td></tr></table></figure>
<h2 id="写入文件：w命令"><a href="#写入文件：w命令" class="headerlink" title="写入文件：w命令"></a>写入文件：w命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/test/w file&apos; example</span><br><span class="line"></span><br><span class="line">sed &apos;/t/w write.txt&apos; test.txt</span><br><span class="line"></span><br><span class="line">在example中所有包含test的行都被写入file里</span><br></pre></td></tr></table></figure>
<h2 id="保持和获取：h命令和G命令"><a href="#保持和获取：h命令和G命令" class="headerlink" title="保持和获取：h命令和G命令"></a>保持和获取：h命令和G命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -e &apos;/test/h&apos; -e &apos;$G&apos; file</span><br><span class="line"></span><br><span class="line">最后一个包含test的行都被复制并追加到该文件的末尾</span><br></pre></td></tr></table></figure>
<h2 id="保持和互换：h命令和x命令"><a href="#保持和互换：h命令和x命令" class="headerlink" title="保持和互换：h命令和x命令"></a>保持和互换：h命令和x命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">互换模式空间和保持缓冲区的内容。也就是把最后一个包含test与check的行互换：</span><br><span class="line"></span><br><span class="line">sed -e &apos;/test/h&apos; -e &apos;/check/x&apos; file</span><br></pre></td></tr></table></figure>
<h2 id="expression">正则表达式</h2>

<p>1.^ 匹配行的开始</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;Call\nTall\nBall&quot; | sed -n &apos;/^C/ p&apos;</span><br><span class="line"></span><br><span class="line">    Call</span><br></pre></td></tr></table></figure>
<p>2.$ 匹配行的结尾</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;str1\nstr2\nstr3\nstr4\nstr33&quot; | sed -n &apos;/3$/ p&apos;</span><br><span class="line"></span><br><span class="line">    str3</span><br><span class="line">    str33</span><br></pre></td></tr></table></figure>
<p>3..匹配单个字符（除行尾）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;cat\nbat\nrat\nmat\nbatting\nrats\nmats&quot; | sed -n &apos;/^..t$/p&apos;</span><br><span class="line"></span><br><span class="line">    cat</span><br><span class="line">    bat</span><br><span class="line">    rat</span><br><span class="line">    mat</span><br></pre></td></tr></table></figure>
<p>4.[] 匹配字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;Call\nTall\nBall&quot; | sed -n &apos;/[CT]all/ p&apos;</span><br><span class="line"></span><br><span class="line">    Call</span><br><span class="line">    Tall</span><br></pre></td></tr></table></figure>
<p>5.[^] 排除字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;Call\nTall\nBall&quot; | sed -n &apos;/[^CT]all/ p&apos;</span><br><span class="line">    </span><br><span class="line">    Ball</span><br></pre></td></tr></table></figure>
<p>6.[-] 字符范围</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;Call\nTall\nBall&quot; | sed -n &apos;/[C-Z]all/ p&apos;</span><br><span class="line"></span><br><span class="line">    Call </span><br><span class="line">    Tall</span><br></pre></td></tr></table></figure>
<p>7.? ，+ ，*</p>
<p>分别对应0次到1次，一次到多次，0次到多次匹配。</p>
<p>8.{n} ，{n,} ，{m, n}</p>
<p>精确匹配N次，至少匹配N次，匹配M-N次</p>
<p>9.|或操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;str1\nstr2\nstr3\nstr4&quot; | sed -n &apos;/str\(1\|3\)/ p&apos; </span><br><span class="line"></span><br><span class="line">    str1</span><br><span class="line">    str3</span><br></pre></td></tr></table></figure>
<p>10.\s匹配单个空白内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;Line\t1\nLine2&quot; | sed -n &apos;/Line\s/ p&apos;</span><br><span class="line">    </span><br><span class="line">    Line 1</span><br></pre></td></tr></table></figure>
<p>11.\S匹配单个非空白内容。</p>
<p>12.\w ， \W单个单词、非单词</p>
<p>不支持\d</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1、定位行：</span><br><span class="line">sed -n &apos;12,~3p&apos; pass #从第12行开始，直到下一个3的倍数行（12-15行）</span><br><span class="line">sed -n &apos;12,+4p&apos; pass #从第12行开始，连续4行（12-16行）</span><br><span class="line">sed -n &apos;12~3p&apos; pass #从第12行开始，间隔3行输出一次（12，15，18，21...）</span><br><span class="line">sed -n &apos;10,$p&apos; pass   #从第10行至结尾</span><br><span class="line">sed -n &apos;4!p&apos; pass   #除去第4行</span><br><span class="line"></span><br><span class="line">2、正则：&apos;/正则式/&apos;</span><br><span class="line">sed -n &apos;/root/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/^root/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/bash$/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/ro.t/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/ro*/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/[ABC]/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/[A-Z]/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/[^ABC]/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/^[^ABC]/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/\&lt;root/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;/root\&gt;/p&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">3、扩展正则：</span><br><span class="line">sed -n &apos;/root\|yerik/p&apos; /etc/passwd #拓展正则需要转义</span><br><span class="line">sed -nr &apos;/root|yerik/p&apos; /etc/passwd #加-r参数支持拓展正则</span><br><span class="line">sed -nr &apos;/ro(ot|ye)rik/p&apos; /etc/passwd #匹配rootrik和royerik单词</span><br><span class="line">sed -nr &apos;/ro?t/p&apos; /etc/passwd   #?匹配0-1次前导字符</span><br><span class="line">sed -nr &apos;/ro+t/p&apos; /etc/passwd   #匹配1-n次前导字符</span><br><span class="line">sed -nr &apos;/ro&#123;2&#125;t/p&apos; /etc/passwd   #匹配2次前导字符</span><br><span class="line">sed -nr &apos;/ro&#123;2,&#125;t/p&apos; /etc/passwd   #匹配多于2次前导字符</span><br><span class="line">sed -nr &apos;/ro&#123;2，4&#125;t/p&apos; /etc/passwd #匹配2-4次前导字符</span><br><span class="line">sed -nr &apos;/(root)*/p&apos; /etc/passwd   #匹配0-n次前导单词</span><br><span class="line"></span><br><span class="line">4、sed编辑（对行的插入、删除、替换操作）</span><br><span class="line">sed &apos;/root/a admin&apos; /etc/passwd   #在root行后追加一个admin行</span><br><span class="line">sed &apos;/root/i admin&apos; /etc/passwd   #在root行前插入一个admin</span><br><span class="line">sed &apos;/root/c admin&apos; /etc/passwd   #将root行替换为admin</span><br><span class="line">sed &apos;/root/d&apos; /etc/passwd    #删除含有root的行</span><br><span class="line"></span><br><span class="line">s替换</span><br><span class="line">sed -n &apos;s/root/admin/p&apos; /etc/passwd</span><br><span class="line">sed -n &apos;s/root/admin/2p&apos; /etc/passwd        #在每行的第2个root作替换</span><br><span class="line">sed -n &apos;s/root/admin/gp&apos; /etc/passwd</span><br><span class="line">sed -n &apos;1,10 s/root/admin/gp&apos; /etc/passwd</span><br><span class="line">sed -n &apos;s/root/AAA&amp;BBB/2p&apos; /etc/passwd       #将root替换成AAArootBBB，&amp;作反向引用，代替前面的匹配项</span><br><span class="line">sed -ne &apos;s/root/AAA&amp;BBB/&apos; -ne &apos;s/bash/AAA&amp;BBB/p&apos; /etc/passwd #-e将多个命令连接起来，将root或bash行作替换</span><br><span class="line">sed -n &apos;s/root/AAA&amp;BBB/;s/bash/AAA&amp;BBB/p&apos; /etc/passwd   #与上命令功能相同</span><br><span class="line">sed -nr &apos;s/(root)(.*)(bash)/\3\2\1/p&apos; /etc/passwd     #将root与bash位置替换，两标记替换</span><br><span class="line">或sed -n &apos;s/root.∗bash/\3\2\1/p&apos; /etc/passwd</span><br><span class="line">bash:x:0:0:root:/root:/bin/root</span><br><span class="line"></span><br><span class="line">y替换</span><br><span class="line">echo &quot;sorry&quot;|sed &apos;y/ory/ABC/&apos; #一一对应替换（sABBC）</span><br><span class="line">​`</span><br></pre></td></tr></table></figure>
<p><code>`</code></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"># Linux</a>
          
            <a href="/tags/shell/" rel="tag"># shell</a>
          
            <a href="/tags/文件操作/" rel="tag"># 文件操作</a>
          
            <a href="/tags/sed/" rel="tag"># sed</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/16/awk分隔符转义/" rel="next" title="awk分隔符转义">
                <i class="fa fa-chevron-left"></i> awk分隔符转义
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/16/读懂diff/" rel="prev" title="读懂diff">
                读懂diff <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">刘泽明</p>
              <p class="site-description motion-element" itemprop="description">做一个懂业务的程序员</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">731</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">394</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">237</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#grammar"><span class="nav-number">2.</span> <span class="nav-text">基础语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#address"><span class="nav-number">3.</span> <span class="nav-text">行寻址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#number_address"><span class="nav-number">4.</span> <span class="nav-text">数字方式的行寻址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#word_address"><span class="nav-number">5.</span> <span class="nav-text">使用文本模式的行寻址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#command"><span class="nav-number">6.</span> <span class="nav-text">基本命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sed在指定字符前后添加内容"><span class="nav-number">7.</span> <span class="nav-text">sed在指定字符前后添加内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除文件每一行的前k个字符、在文本的行尾或行首添加字符"><span class="nav-number">8.</span> <span class="nav-text">删除文件每一行的前k个字符、在文本的行尾或行首添加字符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除行首空格"><span class="nav-number">9.</span> <span class="nav-text">删除行首空格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#行后和行前添加新行"><span class="nav-number">10.</span> <span class="nav-text">行后和行前添加新行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用变量替换-使用双引号"><span class="nav-number">11.</span> <span class="nav-text">使用变量替换(使用双引号)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#同时执行多个动作"><span class="nav-number">12.</span> <span class="nav-text">同时执行多个动作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符替换-y替换"><span class="nav-number">13.</span> <span class="nav-text">字符替换(y替换)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定开始替换位置"><span class="nav-number">14.</span> <span class="nav-text">指定开始替换位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定定界符"><span class="nav-number">15.</span> <span class="nav-text">指定定界符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#子串匹配标记-1"><span class="nav-number">16.</span> <span class="nav-text">子串匹配标记\1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下一个：n命令"><span class="nav-number">17.</span> <span class="nav-text">下一个：n命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从文件读入：r命令"><span class="nav-number">18.</span> <span class="nav-text">从文件读入：r命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#写入文件：w命令"><span class="nav-number">19.</span> <span class="nav-text">写入文件：w命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保持和获取：h命令和G命令"><span class="nav-number">20.</span> <span class="nav-text">保持和获取：h命令和G命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保持和互换：h命令和x命令"><span class="nav-number">21.</span> <span class="nav-text">保持和互换：h命令和x命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#expression"><span class="nav-number">22.</span> <span class="nav-text">正则表达式</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-[object Object]"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘泽明</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
