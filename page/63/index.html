<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="搬运工 + 践行者" type="application/atom+xml">






<meta name="description" content="做一个懂业务的程序员">
<meta property="og:type" content="website">
<meta property="og:title" content="搬运工 + 践行者">
<meta property="og:url" content="http://blog.com/page/63/index.html">
<meta property="og:site_name" content="搬运工 + 践行者">
<meta property="og:description" content="做一个懂业务的程序员">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="搬运工 + 践行者">
<meta name="twitter:description" content="做一个懂业务的程序员">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.com/page/63/">





  <title>搬运工 + 践行者</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">搬运工 + 践行者</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录学习的技能和遇到的问题</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘泽明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="搬运工 + 践行者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/24/如何判断一个数是否在40亿个整数中/" itemprop="url">如何判断一个数是否在40亿个整数中</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-24T12:12:57+08:00">
                2019-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/" itemprop="url" rel="index">
                    <span itemprop="name">面试现场</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/位图法/" itemprop="url" rel="index">
                    <span itemprop="name">位图法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/位图法/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="如何判断一个数是否在40亿个整数中"><a href="#如何判断一个数是否在40亿个整数中" class="headerlink" title="如何判断一个数是否在40亿个整数中"></a>如何判断一个数是否在40亿个整数中</h1><p><br></p>
<blockquote>
<p>原文地址：<a href="https://mp.weixin.qq.com/s?__biz=MzIzMTE1ODkyNQ==&amp;mid=2649409856&amp;idx=1&amp;sn=448772acaf9b2f1a87f4d7c1caf4caa9&amp;chksm=f0b60ca2c7c185b4cb93d0deffed461e6ba3e421e362c17102415e351a496792fa26e0282dc0&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIzMTE1ODkyNQ==&amp;mid=2649409856&amp;idx=1&amp;sn=448772acaf9b2f1a87f4d7c1caf4caa9&amp;chksm=f0b60ca2c7c185b4cb93d0deffed461e6ba3e421e362c17102415e351a496792fa26e0282dc0&amp;scene=21#wechat_redirect</a></p>
</blockquote>
<p><br></p>
<p>小史是一个应届生，虽然学的是电子专业，但是自己业余时间看了很多互联网与编程方面的书，一心想进BAT。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/1.webp" alt="img"></p>
<p>今天他就去BAT中的一家面试了。</p>
<p>简单的自我介绍后，面试官给了小史一个问题。</p>
<p><strong>【面试现场】</strong></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/2.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/3.webp" alt="img"></p>
<p><strong>题目：我有40亿个整数，再给一个新的整数，我需要判断新的整数是否在40亿个整数中，你会怎么做？</strong></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/4.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/5.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/6.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/7.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/8.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/9.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/10.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/11.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/12.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/13.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/14.webp" alt="img"></p>
<p><strong>【请教大神】</strong></p>
<p>小史回到学校，把面试的情况和计算机学院的吕老师说了一下。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/15.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/16.webp" alt="img"></p>
<p>小史忙拉着吕老师问，为什么我说分8次加载数据，面试官会说太慢了呢？</p>
<p>吕老师：哈哈，从磁盘加载数据是磁盘io操作，是非常慢的，你每次都要加载这么大的数据，还要8次，我估计你找一个数的时间可以达到分钟甚至小时级了。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/17.webp" alt="img"></p>
<p>小史：那如果是你，你会怎么办呢？</p>
<p>吕老师：其实面试官已经提示得比较明显了，他说给你一批机器，就是暗示你可以用分布式算法。你把数据分散在8台机器上，然后来一个新的数据，8台机器一起找，最后再汇总结果就行了。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/18.webp" alt="img"></p>
<p>小史：这样的话能快多少？</p>
<p>吕老师：这样应该能达到秒级。小史，你可以自己分析分析。</p>
<p>小史：我想想……哦，这样做的话，因为每台机器都可以一次性把数据读入内存，在比较的时候不用来回加载数据了，所以可以节省加载数据的开销！这真是个好办法。</p>
<p><strong>【更好方案】</strong></p>
<p>吕老师：其实这并不是最好方法，我这还有一种毫秒级的方法，想不想知道啊？</p>
<p>小史：当然想啊，快教教我。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/19.webp" alt="img"></p>
<p>小史：哦，对哦，这样我就申请40亿个位就好了，新的数转换成一个位，然后判断一下这个位是0还是1就行了。</p>
<p>吕老师：小史啊，考虑问题要考虑清楚啊，如果是40亿个位，那么这40亿个位哪些是0，哪些是1呢？来了一个新的数，怎么判断是否在40亿个位之中？</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/20.webp" alt="img"></p>
<p>小史：我想想，对啊，40亿个位，40亿个数，那么每个位都是1，这。。。</p>
<p>吕老师：其实你可以想想，32位int的范围，总共就是2的32次方，大概42亿多点。所以你可以申请2的32次方个位。</p>
<p>小史：意思是我把整个整数范围都覆盖了，哦，对哦。这样一来，就可以做了，1代表第一个位，2代表第二个位，2的32次方代表最后一个位。40亿个数中，存在的数就在相应的位置1，其他位就是0。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/21.webp" alt="img"></p>
<p>吕老师：没错，那来了一个新的数呢？</p>
<p>小史：新的数就去找相应的位，比如来了一个1234，就找一下第1234位，如果是1就存在，是0就不存在啦。</p>
<p>吕老师：没错，那么这样的话，需要多大内存呢？</p>
<p>小史：我想想啊，2的32次方个位，相当于2的29次方个字节，哇，才500MB，真是节省了不少内存呢。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/22.webp" alt="img"></p>
<p>小史：这么厉害的算法，你是怎么想到的？</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/23.webp" alt="img"></p>
<p>吕老师：其实这是一种非常有名的大数据算法，叫位图法，英文名叫<code>bitmap</code>。顾名思义，就是用位来表示状态，从而节省空间。明天正好我有一节课，就讲位图法，你可以来听一听。</p>
<p><strong>【吕老师的课】</strong></p>
<p>第二天，吕老师开始上课，他一开始就抛出了小史遇到的面试题。</p>
<p>吕老师：同学们，这道题是BAT公司的一道面试题，大家有什么思路吗？</p>
<p>话音刚落，蛋哥就站起来回答。蛋哥是吕老师最得意的门生，以思维活跃著称。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/24.webp" alt="img"></p>
<p>蛋哥：我觉得可以这样。首先，32位int的范围是42亿，40亿整数中肯定有一些是连续的，我们可以先对数据进行一个外部排序，然后用一个初始的数和一个长度构成一个数据结构，来表示一段连续的数，举个例子。</p>
<p>如果数据是<code>1 2 3 4 6 7……</code>这种的，那么可以用<code>(1,4)</code>和<code>(6,2)</code>来表示，这样一来，连续的数都变成了2个数表示。</p>
<p>来了一个新数之后，就用二分法进行查找了。</p>
<p>这样一来，最差情况就是2亿多的断点，也就是2亿多的结构体，每个结构体8个字节，大概16亿字节，1.6GB，在内存中可以放下。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/25.webp" alt="img"></p>
<p>吕老师：嗯，非常好，不仅给出了方案，还能主动分析空间和可行性。</p>
<p>小史听完后深感佩服，问题的解决方法绝对不止一种，只要肯动脑筋，即使没有学过bitmap算法，也能有别的方法来解决问题。</p>
<p><strong>【课后】</strong></p>
<p>下课后，小史又找到吕老师。</p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/26.webp" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何判断一个数是否在40亿个整数中/27.webp" alt="img"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.com/2019/05/24/如何在10亿数中找出前1000大的数/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘泽明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="搬运工 + 践行者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/24/如何在10亿数中找出前1000大的数/" itemprop="url">如何在10亿数中找出前1000大的数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-24T12:12:57+08:00">
                2019-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/" itemprop="url" rel="index">
                    <span itemprop="name">面试现场</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="如何在10亿数中找出前1000大的数"><a href="#如何在10亿数中找出前1000大的数" class="headerlink" title="如何在10亿数中找出前1000大的数"></a>如何在10亿数中找出前1000大的数</h1><p><br></p>
<blockquote>
<p>原文地址：<a href="https://mp.weixin.qq.com/s?__biz=MzIzMTE1ODkyNQ==&amp;mid=2649410393&amp;idx=1&amp;sn=e2aae1e16baede316922c53256a10c5f&amp;chksm=f0b60ebbc7c187ad4e48b140daff2c80e5007076e99b26427fef50dd7f19ffed5181ba45baed&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIzMTE1ODkyNQ==&amp;mid=2649410393&amp;idx=1&amp;sn=e2aae1e16baede316922c53256a10c5f&amp;chksm=f0b60ebbc7c187ad4e48b140daff2c80e5007076e99b26427fef50dd7f19ffed5181ba45baed&amp;scene=21#wechat_redirect</a></p>
</blockquote>
<p><br></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzctMH7BGDEKicbm0iac5rib21ibsl5ffljKH00F9pdCs9vqvlzNgkicVxctfQcJ8e7PKEAaOFqmzkLmR9Q.jpeg" alt="img"></p>
<p>小史是一个应届生，虽然学的是电子专业，但是自己业余时间看了很多互联网与编程方面的书，一心想进BAT互联网公司。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K7kvHOpMHD2kgBSu2f0eKeReswC2ibZEneibEvue9W29UcKNxq9vTmUrA.jpeg" alt="img"></p>
<p>之前小史在BAT三家的面试中已经挂了两家，今天小史去了BAT中的最后一家面试了。</p>
<p>简单的自我介绍后，面试官给了小史一个问题。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KWS6s1KxtV07sOsz5CEdv8D8u0nufCPQeaToWTmQpHsHb0qXPugbvbg.jpeg" alt="img"></p>
<p><strong>【面试现场】</strong></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KaW8Xn2QPyeZAVzKgSPV7L2k1kUjjYZiayribywTDsY2jXpHjC9LwSfqw.jpeg" alt="img"></p>
<p><strong>题目：如何在10亿数中找出前1000大的数？</strong></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KT9snKp89fwsj6l8CAeEJTW0Sh4ibibIHKmN8GNYuGpFjE5ziadicncOaTg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KCgZntlnDuBzriaPbSkN7vCYhjTua2LhrHZyaW9kG4Ajc0s5kuyA70Kw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KwX7tVcBoIXrNCLR4ibF9njSdl3LJqRAxFtK6LOIR4hUI8TC57dK3eibA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KJvMpiazia1mDC0uia5XnQZ8RCOJd63em1gPDSj8DHFRlN56TToDWvVQqA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K2yINKyHmksqCBibYf4dcwWyoK5ConwBvL5Fhxd29aXTt4lS7VZFwKsw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KwTYh69mfhlZclnE0iczlPNRx5X2sH5ALGdIHWp8TicBDwCzibB7g9LxNA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5Kibo7NviciaIsF0LxEbiclKIYjxdxJk1ibvGAu3NatGU2Q8gxdIM00S4lHgA.jpeg" alt="img"></p>
<p>小史：我可以用分治法，这有点类似快排中<code>partition</code>的操作。随机选一个数t，然后对整个数组进行<code>partition</code>，会得到两部分，前一部分的数都大于t，后一部分的数都小于t。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K5h2C2Wbj7DJFXRLEKicWtzFYrY1VRptR84XUIn8Cca0SNmDM4docemQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KIBXkvmovwxtsdsSuwHHuSBLWRzPy3WC1rD9Ao4tOfXjZicHIv7yNymA.jpeg" alt="img"></p>
<p>小史：<strong>如果说前一部分总数大于1000个，那就继续在前一部分进行<code>partition</code>寻找。如果前一部分的数小于1000个，那就在后一部分再进行<code>partition</code>，寻找剩下的数</strong>。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDo2ghNUTKjboqicoe1rs5ZucO2u4VcyYKZP9RWxlXjxYibKQ15j6FuibxtQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5Kic7MR1Dr3cbic3DNEflzgeibf9OAUlJx8KAXjh79Wmu5SmnC527b8c0Eg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KUrgy4jSHj1Ixwy2P3TfkO0CdJKvAzofBePzriaFeSNPUo2nVuwicCp2A.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KjauOz0Mx8GAKqLcoJolmJMc7AGrd2ia4YZMZImrl2YTaicxRXFriaLmPg.jpeg" alt="img"></p>
<p>小史：首先，<code>partition</code>的过程，时间是<code>o(n)</code>。我们在进行第一次<code>partition</code>的时候需要花费n，第二次<code>partition</code>的时候，数据量减半了，所以只要花费<code>n/2</code>，同理第三次的时候只要花费n/4，以此类推。而<code>n+n/2+n/4+...</code>显然是小于<code>2n</code>的，所以这个方法的渐进时间只有<code>o(n)</code></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDoVu8VwOYNj169r4Cicq59rAAp7GGnueszjW81cZiazNFhgqBLytzKia0Jw.jpeg" alt="img"></p>
<p>（注：这里的时间复杂度计算只是简化计算版，真正严谨的数学证明可以参考算法导论相关分析。）</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K4dbjnvyOVftx4LfGVd4RKT6cDrJJgua6dMIWs6lhoCyiadSVStzictaA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K6MDxamiceNJZu4AWdhsDYAhIiaVnb6nWYfugLeMepZJBuuqpsFQFH22A.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KMPBlwV6W05uQbOxEMibWOD7tOKe5iaCaAqFjNtoIjmQ3McSPuRAMMQ3Q.jpeg" alt="img"></p>
<p>半分钟过去了。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KPkElCdzZ9hQtcY21Tl1L61TlRLIibXQJEt8DpSj5T29dKAGVmia5gIXg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KPFdPcuibVwT982K9LTktlNrSLkfbicuNPekmDDz377ibtbV3HFSIzFCqw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KpW6b78SgW0mZocRnRZRmpric5Z3ZLWGXVgPd193BqrTPuiarGy4OzTCw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5Kb8ZyeIlZsOzRZrJ431tFY58tyYCtd07mIc0rPfRoocwfvSmbg9sWFA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDoEOrHQPRicpQdwC5BzOmaPLgozoDJctuicjCqk8uVscjKIKeS59P0ndSQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KeNKUqwU0BXSRwlicpLz82wP94We9NgBiavN9zr3Bmtcs7d1WUBHibxr3w.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KRpD0nHOhukevficATLwrsJecNzJ07QiaBSzPrMKmR55sOG7iaTBdDxvQw.jpeg" alt="img"></p>
<p>小史一时慌了神。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KmZu1Z6kHvJE4TjH73u7bSULQHc4PAS9picoibUxvcnUCq71sbxYibLl3w.jpeg" alt="img"></p>
<p>他回忆起了之前吕老师给他讲解<a href="http://mp.weixin.qq.com/s?__biz=MzIzMTE1ODkyNQ==&amp;mid=2649409856&amp;idx=1&amp;sn=448772acaf9b2f1a87f4d7c1caf4caa9&amp;chksm=f0b60ca2c7c185b4cb93d0deffed461e6ba3e421e362c17102415e351a496792fa26e0282dc0&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">bitmap</a>时的一些细节。突然有了一个想法。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KPAfwtOEua8ClwDHib1H3QwgTBumCOkLiaz1v4NiaTAMlqXaFkBlspumeg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDoXpc9doQnaMd1nxq6PMChXggYLAddQ3m6nBgBprRFejfhmWiaxyl8Vicw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K49b68XaFBgIOu4JBXur3ZSY9FDzsicpoa7bOxzPuIqHeGpdJRPTw9jA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KqV6ZsibibibI5unkBOicjmL6MHtRHn1ibqHEQdaniaeEAia6yxdrvKV15KgQQ.jpeg" alt="img"></p>
<p>小史在纸上画了画。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KJ3he6Nehbd3ah2zZcibZbBBWsJ4f1w30ibPQnwqEKpQDxzh06EWA49QA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KwUe12fHFJy8DcThm96Bf2kEKjOlTz5lsF11XmqiaxfnibAicFs9kCQJTw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDol2vht9dlQF0cG1icKBreOH9aSrxSuiayz01YErHkNjticG686YBhbaribw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KUqqEEBeaASicflVkXJTib7BhvQ1HmR3VHUicyEUiaibDmYGhZcUvdIo7BFg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KSs5EoQKZ9MBic2wmdtibFKJNs2Q8wQbpHJajicOqUl6bpfUssgKNTwVJA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDocB5utmRia8sVzFzKbFAquZX5klVON1qyag2ewTP2PC3zdnvVaCa82JQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDoXrTPbfsn7VLTMES6n97QrLXVbKv5H1IRzler2341HGaONib4tJ8BmFw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDoDKmvhSooLX1F5dk6Kf2KXulWHpVvhDEBYBKdO5t0bcRBriaPNQ0u2kg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDoyvGVokXShLw30QtRDfjN7MVFzUWBZXpTOlQUgDySP0ds3utO050IvA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzfBiaaLdFPcYObq38F6wTEDo9EbHtQAcgct7DfJYukxExzSxv89BPd4juTfN4m5mHRuUibNNLkz1vhg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K2QQnE5FfBP1CqmWR4oibHuVwC4kZKpWLx94fswQYoUCCDDfhhYkticMw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KRVa98qy3X27eV6wOPvPn77iarpjgiaRgnvQLCC9Ivj0Kxq9Fib4aSyNYw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KVjOo1QTiaaYwM5U9QKIMs3bIrXxrY2CHP0veGGHyOlCMib2EF1HiaY4qg.jpeg" alt="img"></p>
<p>理解了算法之后，小史的代码写起来也是非常快，不一会儿就写好了：</p>
<p><code>TopN.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiaoshi on 2018/10/14.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopN</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 父节点</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">parent</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (n - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 左孩子</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">left</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 右孩子</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">right</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * n + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建堆</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildHeap</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> t = i;</span><br><span class="line">            <span class="comment">// 调整堆</span></span><br><span class="line">            <span class="keyword">while</span>(t != <span class="number">0</span> &amp;&amp; data[parent(t)] &gt; data[t]) &#123;</span><br><span class="line">                <span class="keyword">int</span> temp = data[t];</span><br><span class="line">                data[t] = data[parent(t)];</span><br><span class="line">                data[parent(t)] = temp;</span><br><span class="line">                t = parent(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调整data[i]</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">adjust</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> n, <span class="keyword">int</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(data[i] &lt;= data[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 置换堆顶</span></span><br><span class="line">        <span class="keyword">int</span> temp = data[i];</span><br><span class="line">        data[i] = data[<span class="number">0</span>];</span><br><span class="line">        data[<span class="number">0</span>] = temp;</span><br><span class="line">        <span class="comment">// 调整堆顶</span></span><br><span class="line">        <span class="keyword">int</span> t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>( (left(t) &lt; n &amp;&amp; data[t] &gt; data[left(t)])</span><br><span class="line">            || (right(t) &lt; n &amp;&amp; data[t] &gt; data[right(t)]) ) &#123;</span><br><span class="line">            <span class="keyword">if</span>(right(t) &lt; n &amp;&amp; data[right(t)] &lt; data[left(t)]) &#123;</span><br><span class="line">                <span class="comment">// 右孩子更小，置换右孩子</span></span><br><span class="line">                temp = data[t];</span><br><span class="line">                data[t] = data[right(t)];</span><br><span class="line">                data[right(t)] = temp;</span><br><span class="line">                t = right(t);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 否则置换左孩子</span></span><br><span class="line">                temp = data[t];</span><br><span class="line">                data[t] = data[left(t)];</span><br><span class="line">                data[left(t)] = temp;</span><br><span class="line">                t = left(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 寻找topN，该方法改变data，将topN排到最前面</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findTopN</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先构建n个数的小顶堆</span></span><br><span class="line">        buildHeap(n, data);</span><br><span class="line">        <span class="comment">// n往后的数进行调整</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = n; i &lt; data.length; i++) &#123;</span><br><span class="line">            adjust(i, n, data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印数组</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">            System.out.print(data[i] + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(友情提示：可左右滑动)</p>
<p><code>Main.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiaoshi on 2018/10/14.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        TopN topN = <span class="keyword">new</span> TopN();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第一组测试</span></span><br><span class="line">        <span class="keyword">int</span>[] arr1 = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">56</span>, <span class="number">30</span>, <span class="number">71</span>, <span class="number">18</span>, <span class="number">29</span>, <span class="number">93</span>, <span class="number">44</span>, <span class="number">75</span>, <span class="number">20</span>, <span class="number">65</span>, <span class="number">68</span>, <span class="number">34</span>&#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"原数组："</span>);</span><br><span class="line">        topN.print(arr1);</span><br><span class="line">        topN.findTopN(<span class="number">5</span>, arr1);</span><br><span class="line">        System.out.println(<span class="string">"调整后数组："</span>);</span><br><span class="line">        topN.print(arr1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二组测试</span></span><br><span class="line">        <span class="keyword">int</span>[] arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1000</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr2.length; i++) &#123;</span><br><span class="line">            arr2[i] = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"原数组："</span>);</span><br><span class="line">        topN.print(arr2);</span><br><span class="line">        topN.findTopN(<span class="number">50</span>, arr2);</span><br><span class="line">        System.out.println(<span class="string">"调整后数组："</span>);</span><br><span class="line">        topN.print(arr2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第三组测试</span></span><br><span class="line">        Random random =<span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">int</span>[] arr3 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1000</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr3.length; i++) &#123;</span><br><span class="line">            arr3[i] = random.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"原数组："</span>);</span><br><span class="line">        topN.print(arr3);</span><br><span class="line">        topN.findTopN(<span class="number">50</span>, arr3);</span><br><span class="line">        System.out.println(<span class="string">"调整后数组："</span>);</span><br><span class="line">        topN.print(arr3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(友情提示：可左右滑动)</p>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">原数组：</span><br><span class="line">56 30 71 18 29 93 44 75 20 65 68 34 </span><br><span class="line">调整后数组：</span><br><span class="line">65 68 71 75 93 18 29 30 20 44 56 34 </span><br><span class="line">原数组：</span><br><span class="line">1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100  </span><br><span class="line">调整后数组：</span><br><span class="line">951 952 955 954 953 956 957 963 968 964 972 961 979 959 958 967 966 969 974 965 970 973 988 962 983 993 986 981 987 992 960 976 1000 982 978 977 975 985 984 990 971 997 996 991 989 999 998 980 994 995 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 </span><br><span class="line">原数组：</span><br><span class="line">835636999 -90522479 -769818338 -1416245398 1041573706 1812203535 896607110 1789246766 1774883884 26722194 -418633859 1344767118 1570967674 1316806558 -1435502178 1473470755 -918439629 1869702742 2101404773 -1296472335 649689400 1153902366 -1052670714 498645159 -1530905537 -1159220094 -154125959 -868393434 -504505075 -1106082731 -494609447 -1406763201 -750828828 -342445539 -744595730 -1920006464 -1230413255 -1426324562 -1277878264 474935729 -2029054806 447026196 -1121975794 -1448358181 1957166126 1336854710 …… </span><br><span class="line">调整后数组：</span><br><span class="line">1960093727 1964906931 1970688292 1975808864 1981745799 1991241336 2022661667 1981095418 1998580270 1988169309 2008783098 2027208746 2136972032 2062185334 2058314391 2003774732 2022245178 2022674254 2076406457 2024695646 2106449320 2016192325 2039153729 2043057170 2042482994 2138695524 2139809413 2121618159 2067898415 2122335504 2101895240 2100462015 2054036800 2037921932 2067998974 2117710597 2133594097 2101404773 2077564852 2033907579 2035097590 2108250457 2122256662 2138496647 2088084171 2107415856 2077919162 ……</span><br></pre></td></tr></table></figure>
<p>(友情提示：可左右滑动)</p>
<p>（注：由于1000个数字符过多，超了微信文章限制，结果进行了省略，大家可以本地运行查看结果）</p>
<p>面试官看了一下。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K2D7NGFTGABB3aBzIbciatticX25XRqDTCyoeGsXr4iaawiaBDAVBQRwklQ.jpeg" alt="img"></p>
<p>小史熟练地介绍起了自己的项目，由于准备充分，小史聊起来游刃有余。面试官问的几个问题也进行了详细的解释。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KYMGaQ5TSrbCkkq3S311ibD3VX7qORuaaticPSiabzvialc3DWWQbbTsoeQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KCTyNZicduKzJznOZnqPHg8cOY2WicTHop0m6aeR4R5vnvibzrP5crP3Lg.jpeg" alt="img"></p>
<p>小史走后，面试官在系统中写下了面试评语：</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p><strong>【遇见吕老师】</strong></p>
<p>小史回到学校哼着歌走在校园的路上，正好碰到吕老师。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KNNURicGzckTEmjCdmlqd7zjE3LzwmA5eFTvdBxYVBZPibLYnEbfxSXmA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KFtNMznxEN04JsycVqmycE1RBQjrFeMfHHV2bznDwCGMcoAiamVR5picw.jpeg" alt="img"></p>
<p>小史把面试情况和吕老师说了一下。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5KGToejuGDqXmjOUD2TnBXZQMJHxZFKosoB9oEmzydlbiacFz36nDLs7g.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p>小史：感悟还挺深的。虽然平时做过<code>topN</code>的问题，知道分治法时间更少。但是碰到具体问题的时候还是要具体分析，这种大数据量的情况下反而用堆会更快。</p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K749FKuicpZF3zkCTSmINRhPq0DInP2KBafR3AeTs712hw6JciaL69G0g.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何在10亿数中找出前1000大的数/1eDWTgj1vzeYy3q8aVysD3OqX0DsAj5K1PFPbcfmYLuicIrHSusXYF6jkoSR3oPavTxIUcm9slSRa3twyKDJH4w.jpeg" alt="img"></p>
<hr>
<p>面试现场是互联网侦察推出的一个新的板块，旨在回放真实的面试过程，并对面试题进行全面解析，提供多种思路，比较优劣，希望对大家的面试有所帮助。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.com/2019/05/24/如何找到字符串中的最长回文子串/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘泽明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="搬运工 + 践行者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/24/如何找到字符串中的最长回文子串/" itemprop="url">如何找到字符串中的最长回文子串</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-24T12:12:57+08:00">
                2019-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/" itemprop="url" rel="index">
                    <span itemprop="name">面试现场</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/回文串/" itemprop="url" rel="index">
                    <span itemprop="name">回文串</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/回文串/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="如何找到字符串中的最长回文子串"><a href="#如何找到字符串中的最长回文子串" class="headerlink" title="如何找到字符串中的最长回文子串"></a>如何找到字符串中的最长回文子串</h1><p><br></p>
<blockquote>
<p>原文地址：<a href="https://mp.weixin.qq.com/s?__biz=MzIzMTE1ODkyNQ==&amp;mid=2649410225&amp;idx=1&amp;sn=ed045e8edc3c49a436a328e5f0f37a55&amp;chksm=f0b60f53c7c18645b4c04a69ad314723cce94ed56994d6f963c2275a2db8d85f973f15f508e4&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIzMTE1ODkyNQ==&amp;mid=2649410225&amp;idx=1&amp;sn=ed045e8edc3c49a436a328e5f0f37a55&amp;chksm=f0b60f53c7c18645b4c04a69ad314723cce94ed56994d6f963c2275a2db8d85f973f15f508e4&amp;scene=21#wechat_redirect</a></p>
</blockquote>
<p><br></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzctMH7BGDEKicbm0iac5rib21ibsl5ffljKH00F9pdCs9vqvlzNgkicVxctfQcJ8e7PKEAaOFqmzkLmR9Q.jpeg" alt="img"></p>
<p>小史是一个应届生，虽然学的是电子专业，但是自己业余时间看了很多互联网与编程方面的书，一心想进BAT互联网公司。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzf7SKjhz9TT52Ex1pyEzE8cYHyjLT8A9Q88GkSbTgczLE4RPibQ0IickOuXmBWBibBD2njK5LWiahPh3g.jpeg" alt="img"></p>
<p>今天他又去一家互联网小巨头公司面试了。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzf7SKjhz9TT52Ex1pyEzE8cLZXHgc7V0VjfGHdib2WrR274WBu6jWJiarwSWPFbUiafDvGRrHSZjpqEQ.jpeg" alt="img"></p>
<p><strong>【面试现场】</strong></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzfBdUbfqnichSSU4JXMVfWzFwOVkAou4BcU8qhmEEQibt1JRhKukibzWeuepzib6BpoyOOrQt78pIjECw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzfBdUbfqnichSSU4JXMVfWzF6TZa1NicZ1a7Hyia2qA1NgKicfUmVubodsfibCsCfHVazDwrrEOWw9NibZg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzfBdUbfqnichSSU4JXMVfWzFib3InX7hUbF8Lf2icNhtIzaSnPKqrticErOwoPqjRYLoU6wTmVLXrpibJA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzfBdUbfqnichSSU4JXMVfWzF0DcfRicoAZILkBqRg6Emnw0vHJEk9ZUoBcJYZCqicGyAic9pgNAKuXEdw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzfBdUbfqnichSSU4JXMVfWzF2s5QSPrQicibCnKiaXs1ZXo8DvkBkP6Ua8m5qVov2R1tHiayN6ia89FuIpA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzfBdUbfqnichSSU4JXMVfWzF89bNX7nmAnuRwSjXSAEnM4ibVRHEDhspibjibT0vMCrIwIySLia3AkMZfA.jpeg" alt="img"></p>
<p>小史：只要先对比第一个字符和倒数第一个字符，再对比第二个字符和倒数第二个字符，以此类推。如果都相等，那就是回文串了。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCibr6JMGjauC8htibqE8OTYANvx8OuWw6aUR5znW6hQRnMuyA2R7n6BnQ.jpeg" alt="img"></p>
<p><strong>题目：给你一个字符串，找出里面最长的回文子串</strong></p>
<p><strong>例如</strong></p>
<p><strong>输入abcdcef，那么输出应该是cdc</strong></p>
<p><strong>输入adaelele，输出应该是elele</strong></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCiaibYaJARc9vMGaEibkeTtesJv0DxpkJoibCgvDK0BaX3YpwVozjywRdbg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCzEJNrfIMViaT1eJgHbQ720L7XFFljttD6sqgrG4icO0Oxmqaz3WR4glw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCyia8WanVnoxTSHXDoNdhBgj3aOJzdJFHXGjmpjibhr4XRSWzH2sfslYw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkClXQzNJB62GGD3NOlqxHPwoD00WZlq8icg76fF8XYKj3Tduvibccib4R2Q.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCzoIa02MEWdyLibzn8FkxkmyqLWThicKN4EOOyXpXSLyQzbP6Fib0jHzXg.jpeg" alt="img"></p>
<p>半分钟过去了。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCWMibgw6ibs0mcmDgialmkXKIicaiaQn1Mmfgo8GZGWs8nBsHTjOr9AfIiaAA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCnZxwreRDPRKHib2nOQPCiau397tJao31lHQxn67V3harGiaoZOTCUQGTg.jpeg" alt="img"></p>
<p>小史：可以遍历整个字符串，<strong>把每个字符和字符间的空隙当作回文的中心，然后向两边扩展来找到最长回文串</strong>。</p>
<p>小史这次抢着分析时间和空间复杂度。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCHXpJRDCOvRiapichjrEwwxOLaNiassIoLZtfnDmtDZyxPTT3xfdAlwpCg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCLD05z8IO3ZAAXby1F8zJB44hoZcGt1B9Jv4vnt3rJZ4BEj7o3CiamTw.jpeg" alt=""></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCiaOd3fkDmyhX7bd7ibbCvSphDQyk1vGzVw2dZ5nm0V8Ulia6ibT0jXLtcQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCcfhjnNkYEA2K2SVPlkicHqj9wzkRQ6rmzpD722CL7HgKllcxu2iaQq2g.jpeg" alt="img"></p>
<p>一分钟过去了。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCKQB37AIdia5taz6MfH5wBvuicw5lBcBfG4vhHcMicpw9MT1rwcJoL7fZQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCC3kRfIybMaxMuVmCt4IzWhDgjq42VJyMg3kucXZZjtUkPzbiacZb2aA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p><strong>【请教大神】</strong></p>
<p>小史回到学校，把面试情况和吕老师说了一下。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkC2zmNSDiapZ7Fzibmtnyla9DQy7LRVm4eTHSDdobfLeia3UuySclTawAwQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkC9bZTKNBggicUBjU0XGZKKce5XvcV3xZwam4M7xOLpbZI9RA8l0bdsgg.jpeg" alt="img"></p>
<p>吕老师：比如<code>cabadabae</code>用中心扩展的算法，我已经知道了第三位为中心的<code>aba</code>和第5位为中心的<code>abadaba</code>是回文，那么在判断第7位为中心的回文串的时候，有什么已知信息吗？</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCuHSgmhSZbQFRAQfcmmhHwkzefKeY8oOiaVcR4JCEYDmyribQGoB5fUpg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCpxqhy9rYKo5v0SnprVMYzVSpzgZssS06hNAYvuEaYo0mqzerfd5GaA.jpeg" alt="img"></p>
<p>小史：已知第5位为中心的<code>abadaba</code>是回文，由回文的特性，就能够知道2-4位和6-8位对称，而又知道第3位为中心的<code>aba</code>是回文，所以2-4位是回文。这样的话，6-8位肯定是回文。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCFwl4RnM0xT2ibQogMGkLnBbdPvpOXSVibhK2ia3pMxlKqUJdpdwPN7n2A.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkC3iazAr5Hn3aS6RSC7iaYR17EZWa6SMm6OFhFv2BpfPKpubUbXZLYjjlQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCt3rXKhsocXibM6om2sXkIb3JeftLSAPCgIO9oJtOShYLevr6V2ZOPlQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCMoibAOTb0xNmSaOtibrzlhhSxdEtSoWHpZibHuBupsBrunHWcWBNz8G8g.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCAn9zYTJUoGdGU4NfwtgO7P3KnOm06FeeRUZ8pQeVFpGkcriatRttIgA.jpeg" alt="img"></p>
<p>小史拿着笔在纸上画了半天，突然大叫一声。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p>小史：由于之前的计算已经知道了第5位为中心的<code>abadaba</code>是回文，而第4位为中心的a的回文长度是1，所以第6位为中心的回文长度只能是1，不用再去扩展判断了。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCVufb7e9lQNOw93VmoXibtpSz8WgO5PLG4NEtu8GpqLoS7Kia1SwWhibbA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCh2147JrInwCxtb673DjZznECo0TbQ5ZKDRXslFicgU6N4XfhKung9DQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCMXsIzMB7G5jr1ZiahwjPalUPaGM81z3TMib5SoJsRMAzjrTAIhbCT6tw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCkodtBfRcWQb5nNqQEFUXewlyCxXibk1CZIcb7ib5hyOicLOE2t2cTmI6Q.jpeg" alt="img"></p>
<p>小史：以第7位为中心的回文串的计算，由之前分析已经知道最小长度是3了，但是还是需要进行扩展，因为第9位是什么根据之前的信息无法得知，需要扩展进行探索。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkC8B0brEKlMZsbCklUL3apBQsgSl1KMjn3NPOopvC7zS4pcTyfdwSm3A.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCLNq8BauiakbQ6NicDAXAW0cURBMpY4ax8iak819NicsHHFgzBLiaWb591Cg.jpeg" alt="img"></p>
<p>小史：而以第6位为中心的回文串的计算，并不需要进行探索了，因为根据之前第5位为回文中心串的信息和第4位为回文中心串的信息已经可以推断第6位为回文中心串的长度只能为1。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCa2gWPYh25Yny2XEyvzia4QIO7CCdXnyyic0B1TUUMmut5mSibibDiazov5A.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCpTWP14SFQgMQDFFfQYibpQwoNr5wyw7OaSLrOzSq4yN3iaeOXG1O3Vwg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCWhoDqTDFEH6cjTyibiaZqshCxjSUasxGzaJq7J3H0zGtzwc0R1PfyYkg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCeAakm879LJ8RqoR7K7xbYwRENzhicwib0mY1fwx3Wea2IrZoc7QBeX7A.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCKSsdGU28r5Q2JaiazBwIwV5ca219pialpNcmDcr2HNOpw4AmCNyiaT8yQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkC6x8rJUrmcEONV30KZicjrfXRHhmfNq67WSia5iaEow6MnaibjoRfdXo2FA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrpibALLA0ZGXAhLRo55S8QLDya9jU9CTiajibK4kLmU8CzzbZ7wp7tnIEg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCTUMcTr7oPsgaocnmYK84YxBn9jCxquUyMnZ9Qia7YUYASghictNBOTFg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCmvG7w2Dn1ggA0eHM4uyjYfQ9M6gHGWkft20BBTEHlahms6aVYvOKXA.jpeg" alt="img"></p>
<p>小史：当然可以。</p>
<p>1、首先，我们<strong>要记录下目前已知的回文串能够覆盖到的最右边的地方</strong>，就像案例中的第8位</p>
<p>2、同时，<strong>覆盖到最右边的回文串所对应的回文中心也要记录</strong>，就像案例中的第5位</p>
<p>3、<strong>以每一位为中心的回文串的长度也要记录，后面进行推断的时候能用到</strong>，就像案例中用到的以第3位为中心的回文和第4位为中心的回文</p>
<p>4、对于新的中心，我们判断它是否在右边界内，若在，就计算它相对右边界回文中心的对称位置，从而得到一些信息，同时，如果该中心需要进行扩展，则继续扩展就行。</p>
<p><strong>【编码实现】</strong></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCsDVcU5ibfXWa9JjQ9CYdNficYI08uRaNeAXhiaIVytTZSGFqVciazBeWIA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCLFlNBG4TYdzK1acib4ib34uEfdSNov6pKfLvmTNJyAEtuoxs20tVEdkw.jpeg" alt="img"></p>
<p>小史：回文的中心有可能是两个字符中间，这种情况没有考虑到啊。</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzcyc3n3BNhROr3DJia3saMkCbk61I3XAfty0UO4abZaPEPRXdCRiax8wSwGSYMspuEnUA6ka4MY8wog.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrJRpVRv4RECmUgyRgjp6Hyvnn5btrSEPvm4s1oYicJnLSGB0SEgecx2Q.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrr1gVH0DkrgTYmwdP07ugqJtq30ayY2DqhiaOst5Ct8IxQ3YnQj8ajDYQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrr1dcVPHrQhUia7Dq7AgmDnfbM1RJWjAyMWf6EOLnh0XGk5vgn7nq9Dog.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrr0DdCJvwRspiaqsMBxRfWAicuYgoVXsXQ7sEo4HtJecy87LictjNOtiaaNA.jpeg" alt="img"></p>
<p>小史：</p>
<p>1、先对字符串进行预处理，两个字符之间加上特殊符号#</p>
<p>2、然后遍历整个字符串，用一个数组来记录以该字符为中心的回文长度，为了方便计算右边界，我在数组中记录长度的一半（向下取整）</p>
<p>3、每一次遍历的时候，如果该字符在已知回文串最右边界的覆盖下，那么就计算其相对最右边界回文串中心对称的位置，得出已知回文串的长度</p>
<p>4、判断该长度和右边界，如果达到了右边界，那么需要进行中心扩展探索。当然，如果第3步该字符没有在最右边界的“羽翼”下，则直接进行中心扩展探索。进行中心扩展探索的时候，同时又更新右边界</p>
<p>5、最后得到最长回文之后，去掉其中的特殊符号即可</p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrkWcLUrtejCKfvAvBnXG1Rlwa1bGEFicut9dlJmHgxO3MdbOGoLB6STg.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrTMkH6mNiagzmyrb8tKVQbunvAyYiaCC1eIYBRpOtZkTgZbG0xulzQUbg.jpeg" alt="img"></p>
<p>理解了算法之后，小史的代码写起来也是非常快，不一会儿就写好了：</p>
<p><code>PlalindromeString.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiaoshi on 2018/9/24.</span></span><br><span class="line"><span class="comment"> * Happy Mid-Autumn Festival</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlalindromeString</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断一个字符串是否回文，算法中用不到了</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isPlalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len / <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s.charAt(i) != s.charAt(len - <span class="number">1</span> - i)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 预处理字符串，在两个字符之间加上#</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">preHandleString</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        sb.append(<span class="string">'#'</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            sb.append(s.charAt(i));</span><br><span class="line">            sb.append(<span class="string">'#'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//去掉首尾指定字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">trimFirstAndLastChar</span><span class="params">(String source,<span class="keyword">char</span> element)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> beginIndexFlag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> endIndexFlag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> beginIndex = source.indexOf(element) == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> endIndex = source.lastIndexOf(element) + <span class="number">1</span> == source.length() ? source.lastIndexOf(element) : source.length();</span><br><span class="line"></span><br><span class="line">            source = source.substring(beginIndex, endIndex);</span><br><span class="line"></span><br><span class="line">            beginIndexFlag = (source.indexOf(element) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            endIndexFlag = (source.lastIndexOf(element) + <span class="number">1</span> == source.length());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">while</span> (beginIndexFlag || endIndexFlag);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 寻找最长回文字串</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findLongestPlalindromeString</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先预处理字符串</span></span><br><span class="line">        String str = preHandleString(s);</span><br><span class="line">        <span class="comment">// 处理后的字串长度</span></span><br><span class="line">        <span class="keyword">int</span> len = str.length();</span><br><span class="line">        <span class="comment">// 右边界</span></span><br><span class="line">        <span class="keyword">int</span> rightSide = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 右边界对应的回文串中心</span></span><br><span class="line">        <span class="keyword">int</span> rightSideCenter = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 保存以每个字符为中心的回文长度一半（向下取整）</span></span><br><span class="line">        <span class="keyword">int</span>[] halfLenArr = <span class="keyword">new</span> <span class="keyword">int</span>[len];</span><br><span class="line">        <span class="comment">// 记录回文中心</span></span><br><span class="line">        <span class="keyword">int</span> center = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 记录最长回文长度</span></span><br><span class="line">        <span class="keyword">int</span> longestHalf = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="comment">// 是否需要中心扩展</span></span><br><span class="line">            <span class="keyword">boolean</span> needCalc = <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">// 如果在右边界的覆盖之内</span></span><br><span class="line">            <span class="keyword">if</span>(rightSide &gt; i) &#123;</span><br><span class="line">                <span class="comment">// 计算相对rightSideCenter的对称位置</span></span><br><span class="line">                <span class="keyword">int</span> leftCenter = <span class="number">2</span> * rightSideCenter - i;</span><br><span class="line">                <span class="comment">// 根据回文性质得到的结论</span></span><br><span class="line">                halfLenArr[i] = halfLenArr[leftCenter];</span><br><span class="line">                <span class="comment">// 如果超过了右边界，进行调整</span></span><br><span class="line">                <span class="keyword">if</span>(i + halfLenArr[i] &gt; rightSide) &#123;</span><br><span class="line">                    halfLenArr[i] = rightSide - i;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 如果根据已知条件计算得出的最长回文小于右边界，则不需要扩展了</span></span><br><span class="line">                <span class="keyword">if</span>(i + halfLenArr[leftCenter] &lt; rightSide) &#123;</span><br><span class="line">                    <span class="comment">// 直接推出结论</span></span><br><span class="line">                    needCalc = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 中心扩展</span></span><br><span class="line">            <span class="keyword">if</span>(needCalc) &#123;</span><br><span class="line">                <span class="keyword">while</span>(i - <span class="number">1</span> - halfLenArr[i] &gt;= <span class="number">0</span> &amp;&amp; i + <span class="number">1</span> + halfLenArr[i] &lt; len) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(str.charAt(i + <span class="number">1</span> + halfLenArr[i]) == str.charAt(i - <span class="number">1</span> - halfLenArr[i])) &#123;</span><br><span class="line">                        halfLenArr[i]++;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 更新右边界及中心</span></span><br><span class="line">                rightSide = i + halfLenArr[i];</span><br><span class="line">                rightSideCenter = i;</span><br><span class="line">                <span class="comment">// 记录最长回文串</span></span><br><span class="line">                <span class="keyword">if</span>(halfLenArr[i] &gt; longestHalf) &#123;</span><br><span class="line">                    center = i;</span><br><span class="line">                    longestHalf = halfLenArr[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 去掉之前添加的#</span></span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = center - longestHalf + <span class="number">1</span>; i &lt;= center + longestHalf; i += <span class="number">2</span>) &#123;</span><br><span class="line">            sb.append(str.charAt(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Main.java</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author lixin on 2018/9/24.</span><br><span class="line"> */</span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        PlalindromeString ps = new PlalindromeString();</span><br><span class="line"></span><br><span class="line">        String[] testStrArr = new String[] &#123;</span><br><span class="line">            &quot;abcdcef&quot;,</span><br><span class="line">            &quot;adaelele&quot;,</span><br><span class="line">            &quot;cabadabae&quot;,</span><br><span class="line">            &quot;aaaabcdefgfedcbaa&quot;,</span><br><span class="line">            &quot;aaba&quot;,</span><br><span class="line">            &quot;aaaaaaaaa&quot;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        for(String str : testStrArr) &#123;</span><br><span class="line">            System.out.println(String.format(&quot;原字串 : %s&quot;, str));</span><br><span class="line">            System.out.println(String.format(&quot;最长回文串 : %s&quot;, ps.findLongestPlalindromeString(str)));</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">原字串 : abcdcef</span><br><span class="line">最长回文串 : cdc</span><br><span class="line"></span><br><span class="line">原字串 : adaelele</span><br><span class="line">最长回文串 : elele</span><br><span class="line"></span><br><span class="line">原字串 : cabadabae</span><br><span class="line">最长回文串 : abadaba</span><br><span class="line"></span><br><span class="line">原字串 : aaaabcdefgfedcbaa</span><br><span class="line">最长回文串 : aabcdefgfedcbaa</span><br><span class="line"></span><br><span class="line">原字串 : aaba</span><br><span class="line">最长回文串 : aba</span><br><span class="line"></span><br><span class="line">原字串 : aaaaaaaaa</span><br><span class="line">最长回文串 : aaaaaaaaa</span><br></pre></td></tr></table></figure>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrnynE4YevRMDcpNmsy3UuvdWDZEU7T8q0fFFX9ib9WZ0wkLpIflRowfw.jpeg" alt="img"></p>
<p><strong>【时间空间分析】</strong></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrdrqTW3vafgyECX2hBZN8DVteJaOLMsgk32Lyrr7FC2DHx27Qy5xEUQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrN8zywibXarB3cYWRJlZqmgrzdpdjn0gHZnnUTLtUuqzYLDaNsKxU61w.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrqic8hgibDUjGuhMhAHVCjX3Xo42m9dfkeTRJM5IMvlHdm4kdf9huPbAw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrtmnxxnufdvQVMZIFAslyT2WHSI1W0qBSAPaicGQr2bgDjicgw9pBFwcw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrEibdz4TQzB0C4xYGQKClpJtHGHTO1iax8ibYVP5zj59kzLbVIIwIPpjug.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrr2ubKhicJ7b4jx0xlpOx35f3OJJK1kwcogFKa2GALD3x8AuibGuRx4tA.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrFnLw2nWxcIfa4bibxSn4pqHDticNArKyILgXNdFPR9NCHsZn1biauG2GQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrr1z0TK1jLbrKT4HOAJ6wAqFsYzaI7s3G1bVzoRnW1b9ksKRhHiaic1GUw.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrr5sbSYUvTybmAnkStLlAddfxaf8iauPYpEmUEvpApmuMUEFhdSErPdicQ.jpeg" alt="img"></p>
<p><img src="//blog.com/2019/05/24/如何找到字符串中的最长回文子串/1eDWTgj1vzdQeauPkJ88mbXic9iaRfmHrrEHlU0QlEgtk9H00gcIHibf2Fg9VZVib4rz4oabwa55ic4WUdOXaia3DMxA.jpeg" alt="img"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.com/2019/05/24/位图法应用/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘泽明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="搬运工 + 践行者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/24/位图法应用/" itemprop="url">位图法应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-24T12:12:57+08:00">
                2019-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/" itemprop="url" rel="index">
                    <span itemprop="name">面试现场</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/位图法/" itemprop="url" rel="index">
                    <span itemprop="name">位图法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/面试现场/位图法/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="位图法应用"><a href="#位图法应用" class="headerlink" title="位图法应用"></a>位图法应用</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> 所谓bitmap，就是用每一位来存放某种状态，适用于大规模数据，但数据状态又不是很多的情况。通常是用来判断某个数据存不存在的。</span><br><span class="line">例如，要判断一千万个人的状态，每个人只有两种状态：男人，女人，可以用0，1表示。那么就可以开一个int数组，一个int有32个位，就可以表示32个人。操作的时候可以使用位操作。</span><br></pre></td></tr></table></figure>
<h2 id="判断整形数组中是否有重复数据，时间复杂度为O（n）"><a href="#判断整形数组中是否有重复数据，时间复杂度为O（n）" class="headerlink" title="判断整形数组中是否有重复数据，时间复杂度为O（n）"></a>判断整形数组中是否有重复数据，时间复杂度为O（n）</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;<strong>判断集合中存在重复是常见编程任务之一，当集合中数据量比较大时我们通常希望少进行几次扫描，这时双重循环法就不可取了。位图法比较适合于这种情况，它的做法是按照集合中最大元素max创建一个长度为max+1的新数组，然后再次扫描原数组，遇到几就给新数组的第几位置上1，如遇到 5就给新数组的第六个元素置1，这样下次再遇到5想置位时发现新数组的第六个元素已经是1了，这说明这次的数据肯定和以前的数据存在着重复。这种给新数组初始化时置零其后置一的做法类似于位图的处理方法故称位图法。它的运算次数最坏的情况为2N</strong>。如果已知数组的最大值即能事先给新数组定长的话效率还能提高一倍。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">   /**</span><br><span class="line"> * 判断整形数组中是否有重复数据，时间复杂度为O（n）</span><br><span class="line"> * </span><br><span class="line"> * @param arr</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public static boolean hasDuplicatedItem(int[] arr) &#123;</span><br><span class="line">	// 扫描数组找最大值</span><br><span class="line">	int max = arr[0];</span><br><span class="line">	for (int i = 1; i &lt; arr.length; i++) &#123;</span><br><span class="line">		if (arr[i] &gt; max) &#123;</span><br><span class="line">			max = arr[i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// 按最大值创建一个新数组</span><br><span class="line">	int[] bitArray = new int[max + 1];</span><br><span class="line">	// 按值向新数组中添值，如value为3则bitArray[3]=1</span><br><span class="line">	for (int value : arr) &#123;</span><br><span class="line">		if (bitArray[value] != 0) &#123;</span><br><span class="line">			// 如果value指向的位置已经不是零，说明之前已经给这一块置1了，立即返回true表示数组有重复</span><br><span class="line">			return true;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			// value指向的位置是零,则置为1表示这一位已经有数存在了</span><br><span class="line">			bitArray[value] = 1;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">    int[][] arr = &#123; &#123; 1, 2, 3, 5, 3, 5, 56, 534, 3, 32 &#125;, &#123; 1, 2, 3, 5 &#125;, &#123; 1, 2, 3, 5, 3, 5 &#125;,</span><br><span class="line">			&#123; 0, 0, 1, 2, 3, 5, 56, 534, 78, 32 &#125;, &#125;;</span><br><span class="line">	for (int i = 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">		System.out.print(&quot; 数组: &quot;);</span><br><span class="line">		for (int temp : arr[i]) &#123;</span><br><span class="line">			System.out.print(temp + &quot;, &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.print(&quot; 中 &quot;);</span><br><span class="line">		System.out.print(hasDuplicatedItem(arr[i]) ? &quot; 存在 &quot; : &quot; 不存在 &quot;);</span><br><span class="line">		System.out.print(&quot; 重复元素.\n &quot;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="位图法排序"><a href="#位图法排序" class="headerlink" title="位图法排序"></a>位图法排序</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">    /**</span><br><span class="line"> * 使用位图法进行排序</span><br><span class="line"> * </span><br><span class="line"> * @param arr</span><br><span class="line"> */</span><br><span class="line">public static void bitmapSort(int[] arr) &#123;</span><br><span class="line">	// 找出数组中最值</span><br><span class="line">	int max = arr[0];</span><br><span class="line">	int min = max;</span><br><span class="line">	for (int i : arr) &#123;</span><br><span class="line">		if (max &lt; i) &#123;</span><br><span class="line">			max = i;</span><br><span class="line">		&#125;</span><br><span class="line">		if (min &gt; i) &#123;</span><br><span class="line">			min = i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// 得到位图数组</span><br><span class="line">	int[] newArr = new int[max - min + 1];  //max - min+1说明最多有多少个元素 </span><br><span class="line">	for (int i : arr) &#123; //得到各个元素的位置、各个位置的元素的个数  位置相对于min</span><br><span class="line">		int index = i - min;</span><br><span class="line">		newArr[index]++;</span><br><span class="line">	&#125;</span><br><span class="line">	// 重整arr中的元素</span><br><span class="line">	int index = 0;</span><br><span class="line">	for (int i = 0; i &lt; newArr.length; i++) &#123;</span><br><span class="line">		while (newArr[i] &gt; 0) &#123;</span><br><span class="line">			arr[index] = i + min;</span><br><span class="line">			index++;</span><br><span class="line">			newArr[i]--;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">    int [] arr = &#123; 1 , 7 , - 3 , 0 , 0 , 6 , 6 , 9 , - 11, -3 &#125; ; </span><br><span class="line">	bitmapSort(arr);</span><br><span class="line">	for ( int  i:arr) &#123;</span><br><span class="line">		System.out.print(i + &quot; , &quot; );</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.com/2019/05/23/减少该死的 if else 嵌套/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘泽明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="搬运工 + 践行者">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/23/减少该死的 if else 嵌套/" itemprop="url">减少该死的 if else 嵌套</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-23T12:12:57+08:00">
                2019-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/代码规范与技巧/" itemprop="url" rel="index">
                    <span itemprop="name">代码规范与技巧</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/代码规范与技巧/代码技巧/" itemprop="url" rel="index">
                    <span itemprop="name">代码技巧</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="减少该死的-if-else-嵌套"><a href="#减少该死的-if-else-嵌套" class="headerlink" title="减少该死的 if else 嵌套"></a>减少该死的 if else 嵌套</h1><p><br></p>
<blockquote>
<p>原文地址：<a href="https://www.jianshu.com/p/57c065b124c4" target="_blank" rel="noopener">https://www.jianshu.com/p/57c065b124c4</a></p>
</blockquote>
<p><br></p>
<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不知大家有没遇到过像“横放着的金字塔”一样的<code>if else</code>嵌套：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if (true) &#123;</span><br><span class="line">    if (true) &#123;</span><br><span class="line">        if (true) &#123;</span><br><span class="line">            if (true) &#123;</span><br><span class="line">                if (true) &#123;</span><br><span class="line">                    if (true) &#123;</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我并没夸大其词，我是真的遇到过了！嵌套6、7层，一个函数几百行，简！直！看！死！人！</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>if else</code>作为每种编程语言都不可或缺的条件语句，我们在编程时会大量的用到。但<code>if else</code>一般不建议嵌套超过三层，如果一段代码存在过多的<code>if else</code>嵌套，代码的可读性就会急速下降，后期维护难度也大大提高。所以，我们程序员都应该尽量避免过多的<code>if else</code>嵌套。下面将会谈谈我在工作中如何减少<code>if else</code>嵌套的。</p>
<p><img src="//blog.com/2019/05/23/减少该死的 if else 嵌套/2392382-6958ea585a3691a3.webp" alt="img"></p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在谈我的方法之前，不妨先用个例子来说明<code>if else</code>嵌套过多的弊端。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;想象下一个简单分享的业务需求：<strong>支持分享链接、图片、文本和图文，分享结果回调给用户</strong>（为了不跑题，这里简略了业务，实际复杂得多）。当接手到这么一个业务时，是不是觉得很简单，稍动下脑就可以动手了：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;先定义分享的类型、分享<code>Bean</code>和分享回调类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_LINK = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_IMAGE = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_TEXT = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_IMAGE_TEXT = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShareItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> type;</span><br><span class="line">    String title;</span><br><span class="line">    String content;</span><br><span class="line">    String imagePath;</span><br><span class="line">    String link;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ShareListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> STATE_SUCC = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> STATE_FAIL = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCallback</span><span class="params">(<span class="keyword">int</span> state, String msg)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;好了，然后在定义个分享接口，对每种类型分别进行分享就ok了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">share</span> <span class="params">(ShareItem item, ShareListener listener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (item != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.type == TYPE_LINK) &#123;</span><br><span class="line">            <span class="comment">// 分享链接</span></span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(item.link) &amp;&amp; !TextUtils.isEmpty(item.title)) &#123;</span><br><span class="line">                doShareLink(item.link, item.title, item.content, listener);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"分享信息不完整"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.type == TYPE_IMAGE) &#123;</span><br><span class="line">            <span class="comment">// 分享图片</span></span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(item.imagePath)) &#123;</span><br><span class="line">                doShareImage(item.imagePath, listener);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"分享信息不完整"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.type == TYPE_TEXT) &#123;</span><br><span class="line">            <span class="comment">// 分享文本</span></span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(item.content)) &#123;</span><br><span class="line">                doShareText(item.content, listener);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"分享信息不完整"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.type == TYPE_IMAGE_TEXT) &#123;</span><br><span class="line">            <span class="comment">// 分享图文</span></span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(item.imagePath) &amp;&amp; !TextUtils.isEmpty(item.content)) &#123;</span><br><span class="line">                doShareImageAndText(item.imagePath, item.content, listener);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"分享信息不完整"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"不支持的分享类型"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">            listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"ShareItem 不能为 null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;到此，简单的分享模型就做出来了。有没问题？老实说，如果没什么追求的话，还真没什么问题，至少思路是清晰的。但一周后呢？一个月后呢？或者一年后呢？<code>share</code>方法的分支有15条，这意味着你<strong>每次回看代码得让自己的大脑变成微型的处理器，考虑15种情况</strong>。<strong>如果出现bug，你又得考虑15种情况，并15种情况都要测试下</strong>。再如果现在需要加多分享小视频功能，你又得添加多3个分支，还要改代码，一点都<strong>不“开放-闭合”</strong>。再再如果后面项目交接给他人跟进，他人又要把自己大脑变成处理器来想每个分支的作用，我敢肯定有百分之八十的人都会吐槽代码。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们程序员的脑力不应该花费在无止境的分支语句里的，应该专注于业务本身。所以我们很有必要避免写出多分支嵌套的语句。好的，我们来分析下上面的代码多分支的原因：</p>
<ol>
<li><strong>空值判断</strong></li>
<li><strong>业务判断</strong></li>
<li><strong>状态判断</strong></li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;几乎所有的业务都离不开这几个判断，从而导致<code>if else</code>嵌套过多。那是不是没办法解决了？答案肯定不是的。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上面的代码我是用java写的，对于java程序员来说，空值判断简直使人很沮丧，让人身心疲惫。上面的代码每次回调都要判断一次<code>listener</code>是否为空，又要判断用户传入的<code>ShareItem</code>是否为空，还要判断<code>ShareItem</code>里面的字段是否为空……</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对于这种情况，我采用的方法很简单：接口分层。</p>
<h3 id="减少-if-else-方法一：接口分层"><a href="#减少-if-else-方法一：接口分层" class="headerlink" title="减少 if else 方法一：接口分层"></a>减少 if else 方法一：接口分层</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>所谓接口分层指的是：把接口分为外部和内部接口，所有空值判断放在外部接口完成，只处理一次；而内部接口传入的变量由外部接口保证不为空，从而减少空值判断。</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;来，看代码更加直观：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">share</span><span class="params">(ShareItem item, ShareListener listener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (item == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">            listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"ShareItem 不能为 null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (listener == <span class="keyword">null</span>) &#123;</span><br><span class="line">        listener = <span class="keyword">new</span> ShareListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCallback</span><span class="params">(<span class="keyword">int</span> state, String msg)</span> </span>&#123;</span><br><span class="line">                Log.i(<span class="string">"DEBUG"</span>, <span class="string">"ShareListener is null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shareImpl(item, listener);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shareImpl</span> <span class="params">(ShareItem item, ShareListener listener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (item.type == TYPE_LINK) &#123;</span><br><span class="line">        <span class="comment">// 分享链接</span></span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(item.link) &amp;&amp; !TextUtils.isEmpty(item.title)) &#123;</span><br><span class="line">            doShareLink(item.link, item.title, item.content, listener);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"分享信息不完整"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.type == TYPE_IMAGE) &#123;</span><br><span class="line">        <span class="comment">// 分享图片</span></span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(item.imagePath)) &#123;</span><br><span class="line">            doShareImage(item.imagePath, listener);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"分享信息不完整"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.type == TYPE_TEXT) &#123;</span><br><span class="line">        <span class="comment">// 分享文本</span></span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(item.content)) &#123;</span><br><span class="line">            doShareText(item.content, listener);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"分享信息不完整"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.type == TYPE_IMAGE_TEXT) &#123;</span><br><span class="line">        <span class="comment">// 分享图文</span></span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(item.imagePath) &amp;&amp; !TextUtils.isEmpty(item.content)) &#123;</span><br><span class="line">            doShareImageAndText(item.imagePath, item.content, listener);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"分享信息不完整"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"不支持的分享类型"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;可以看到，上面的代码分为外部接口<code>share</code>和内部接口<code>shareImpl</code>，<code>ShareItem</code>和<code>ShareListener</code>的判断都放在<code>share</code>里完成，那么<code>shareImpl</code>就减少了<code>if else</code>的嵌套了，相当于把<code>if else</code>分摊了。这样一来，代码的可读性好很多，嵌套也不超过3层了。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;但可以看到，<code>shareImpl</code>里还是包含分享类型的判断，也即业务判断，我们都清楚产品经理的脑洞有多大了，分享的类型随时会改变或添加。嗯说到这里相信大家都想到用多态了。多态不但能应付业务改变的情况，也可以用来减少<code>if else</code>的嵌套。</p>
<h3 id="减少-if-else-方法二：多态"><a href="#减少-if-else-方法二：多态" class="headerlink" title="减少 if else 方法二：多态"></a>减少 if else 方法二：多态</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;利用多态，每种业务单独处理，在接口不再做任何业务判断。把<code>ShareItem</code>抽象出来，作为基础类，然后针对每种业务各自实现其子类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ShareItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShareItem</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doShare</span><span class="params">(ShareListener listener)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Link</span> <span class="keyword">extends</span> <span class="title">ShareItem</span> </span>&#123;</span><br><span class="line">    String title;</span><br><span class="line">    String content;</span><br><span class="line">    String link;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Link</span><span class="params">(String link, String title, String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(TYPE_LINK);</span><br><span class="line">        <span class="keyword">this</span>.link = !TextUtils.isEmpty(link) ? link : <span class="string">"default"</span>;</span><br><span class="line">        <span class="keyword">this</span>.title = !TextUtils.isEmpty(title) ? title : <span class="string">"default"</span>;</span><br><span class="line">        <span class="keyword">this</span>.content = !TextUtils.isEmpty(content) ? content : <span class="string">"default"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doShare</span><span class="params">(ShareListener listener)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do share</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Image</span> <span class="keyword">extends</span> <span class="title">ShareItem</span> </span>&#123;</span><br><span class="line">    String imagePath;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Image</span><span class="params">(String imagePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(TYPE_IMAGE);</span><br><span class="line">        <span class="keyword">this</span>.imagePath = !TextUtils.isEmpty(imagePath) ? imagePath : <span class="string">"default"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doShare</span><span class="params">(ShareListener listener)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do share</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Text</span> <span class="keyword">extends</span> <span class="title">ShareItem</span> </span>&#123;</span><br><span class="line">    String content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Text</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(TYPE_TEXT);</span><br><span class="line">        <span class="keyword">this</span>.content = !TextUtils.isEmpty(content) ? content : <span class="string">"default"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doShare</span><span class="params">(ShareListener listener)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do share</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageText</span> <span class="keyword">extends</span> <span class="title">ShareItem</span> </span>&#123;</span><br><span class="line">    String content;</span><br><span class="line">    String imagePath;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageText</span><span class="params">(String imagePath, String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(TYPE_IMAGE_TEXT);</span><br><span class="line">        <span class="keyword">this</span>.imagePath = !TextUtils.isEmpty(imagePath) ? imagePath : <span class="string">"default"</span>;</span><br><span class="line">        <span class="keyword">this</span>.content = !TextUtils.isEmpty(content) ? content : <span class="string">"default"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doShare</span><span class="params">(ShareListener listener)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do share</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（注意：上面每个子类的构造方法还对每个字段做了空值处理，为空的话，赋值<code>default</code>，这样如果用户传了空值，在调试就会发现问题。）</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;实现了多态后，分享接口的就简洁多了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">share</span><span class="params">(ShareItem item, ShareListener listener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (item == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">            listener.onCallback(ShareListener.STATE_FAIL, <span class="string">"ShareItem 不能为 null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (listener == <span class="keyword">null</span>) &#123;</span><br><span class="line">        listener = <span class="keyword">new</span> ShareListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCallback</span><span class="params">(<span class="keyword">int</span> state, String msg)</span> </span>&#123;</span><br><span class="line">                Log.i(<span class="string">"DEBUG"</span>, <span class="string">"ShareListener is null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shareImpl(item, listener);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shareImpl</span> <span class="params">(ShareItem item, ShareListener listener)</span> </span>&#123;</span><br><span class="line">    item.doShare(listener);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;嘻嘻，怎样，内部接口一个<code>if else</code>都没了，是不是很酷~ 如果这个分享功能是自己App里面的功能，不是第三方SDK，到这里已经没问题了。但如果是第三方分享SDK的功能的话，这样<strong>暴露给用户的类增加了很多（各<code>ShareItem</code>的子类，相当于把<code>if else</code>抛给用户了），用户的接入成本提高，违背了“迪米特原则”了</strong>。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;处理这种情况也很简单，再次封装一层即可。<strong>把<code>ShareItem</code>的子类的访问权限降低，在暴露给用户的主类里定义几个方法，在内部帮助用户创建具体的分享类型，这样用户就无需知道具体的类了</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ShareItem <span class="title">createLinkShareItem</span><span class="params">(String link, String title, String content)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Link(link, title, content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShareItem <span class="title">createImageShareItem</span><span class="params">(String ImagePath)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Image(ImagePath);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShareItem <span class="title">createTextShareItem</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Text(content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShareItem <span class="title">createImageTextShareItem</span><span class="params">(String ImagePath, String content)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ImageText(ImagePath, content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;或者有人会说，这样用户也需额外了解多几个方法。我个人觉得让用户了解多几个方法好过了解多几个类，而已方法名一看就能知道意图，成本还是挺小，是可以接受的。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;其实这种情况，更多人想到的是使用工厂模式。嗯，工厂模式能解决这个问题（其实也需要用户额外了解多几个<code>type</code>类型），但<strong>工厂模式难免又引入分支，我们可以用<code>Map</code>消除分支</strong>。</p>
<h3 id="减少-if-else-方法三：使用Map替代分支语句"><a href="#减少-if-else-方法三：使用Map替代分支语句" class="headerlink" title="减少 if else 方法三：使用Map替代分支语句"></a>减少 if else 方法三：使用Map替代分支语句</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;把所有分享类型预先缓存在<code>Map</code>里，那么就可以直接<code>get</code>获取具体类型，消除分支：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Map&lt;Integer, Class&lt;? extends ShareItem&gt;&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    map.put(TYPE_LINK, Link.class);</span><br><span class="line">    map.put(TYPE_IMAGE, Image.class);</span><br><span class="line">    map.put(TYPE_TEXT, Text.class);</span><br><span class="line">    map.put(TYPE_IMAGE_TEXT, ImageText.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShareItem <span class="title">createShareItem</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class&lt;? extends ShareItem&gt; shareItemClass = map.get(type);</span><br><span class="line">        <span class="keyword">return</span> shareItemClass.newInstance();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultShareItem(); <span class="comment">// 返回默认实现，不要返回null</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这种方式跟上面分为几个方法的方式各有利弊，看大家取舍了~</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>讲到这里大家有没收获呢？总结下减少<code>if else</code>的方法：</p>
<ul>
<li>把接口分为外部和内部接口，<strong>所有空值判断放在外部接口完成；而内部接口传入的变量由外部接口保证不为空，从而减少空值判断</strong>。</li>
<li><strong>利用多态，把业务判断消除，各子类分别关注自己的实现，并实现子类的创建方法，避免用户了解过多的类</strong>。</li>
<li><strong>把分支状态信息预先缓存在<code>Map</code>里，直接<code>get</code>获取具体值，消除分支</strong>。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/62/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/62/">62</a><span class="page-number current">63</span><a class="page-number" href="/page/64/">64</a><span class="space">&hellip;</span><a class="page-number" href="/page/147/">147</a><a class="extend next" rel="next" href="/page/64/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">刘泽明</p>
              <p class="site-description motion-element" itemprop="description">做一个懂业务的程序员</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">731</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">394</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">237</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-[object Object]"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘泽明</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
